<html><head><title>C4::Acquisition</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Sat Jun 29 00:15:45 2024 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#FUNCTIONS_ABOUT_BASKETS'>FUNCTIONS ABOUT BASKETS</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#GetBasket'>GetBasket</a>
      <li class='indexItem indexItem3'><a href='#NewBasket'>NewBasket</a>
      <li class='indexItem indexItem3'><a href='#ReopenBasket'>ReopenBasket</a>
      <li class='indexItem indexItem3'><a href='#GetBasketAsCSV'>GetBasketAsCSV</a>
      <li class='indexItem indexItem3'><a href='#GetBasketGroupAsCSV'>GetBasketGroupAsCSV</a>
      <li class='indexItem indexItem3'><a href='#CloseBasketgroup'>CloseBasketgroup</a>
      <li class='indexItem indexItem3'><a href='#ReOpenBaskergroup(%24basketgroupno)'>ReOpenBaskergroup($basketgroupno)</a>
      <li class='indexItem indexItem3'><a href='#ModBasket'>ModBasket</a>
      <li class='indexItem indexItem3'><a href='#ModBasketHeader'>ModBasketHeader</a>
      <li class='indexItem indexItem3'><a href='#GetBasketsByBookseller'>GetBasketsByBookseller</a>
      <li class='indexItem indexItem3'><a href='#GetBasketsInfosByBookseller'>GetBasketsInfosByBookseller</a>
      <li class='indexItem indexItem3'><a href='#GetBasketUsers'>GetBasketUsers</a>
      <li class='indexItem indexItem3'><a href='#ModBasketUsers'>ModBasketUsers</a>
      <li class='indexItem indexItem3'><a href='#CanUserManageBasket'>CanUserManageBasket</a>
      <li class='indexItem indexItem3'><a href='#GetBasketsByBasketgroup'>GetBasketsByBasketgroup</a>
      <li class='indexItem indexItem3'><a href='#NewBasketgroup'>NewBasketgroup</a>
      <li class='indexItem indexItem3'><a href='#ModBasketgroup'>ModBasketgroup</a>
      <li class='indexItem indexItem3'><a href='#DelBasketgroup'>DelBasketgroup</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#FUNCTIONS_ABOUT_ORDERS'>FUNCTIONS ABOUT ORDERS</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#GetBasketgroup'>GetBasketgroup</a>
      <li class='indexItem indexItem3'><a href='#GetBasketgroups'>GetBasketgroups</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#FUNCTIONS_ABOUT_ORDERS'>FUNCTIONS ABOUT ORDERS</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#GetOrders'>GetOrders</a>
      <li class='indexItem indexItem3'><a href='#GetOrdersByBiblionumber'>GetOrdersByBiblionumber</a>
      <li class='indexItem indexItem3'><a href='#GetOrder'>GetOrder</a>
      <li class='indexItem indexItem3'><a href='#ModOrder'>ModOrder</a>
      <li class='indexItem indexItem3'><a href='#ModItemOrder'>ModItemOrder</a>
      <li class='indexItem indexItem3'><a href='#ModReceiveOrder'>ModReceiveOrder</a>
      <li class='indexItem indexItem3'><a href='#CancelReceipt'>CancelReceipt</a>
      <li class='indexItem indexItem3'><a href='#SearchOrders'>SearchOrders</a>
      <li class='indexItem indexItem3'><a href='#TransferOrder'>TransferOrder</a>
      <li class='indexItem indexItem3'><a href='#get_rounding_sql'>get_rounding_sql</a>
      <li class='indexItem indexItem3'><a href='#get_rounded_price'>get_rounded_price</a>
      <li class='indexItem indexItem3'><a href='#GetHistory'>GetHistory</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#GetRecentAcqui'>GetRecentAcqui</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#AddClaim'>AddClaim</a>
      <li class='indexItem indexItem3'><a href='#GetInvoices'>GetInvoices</a>
      <li class='indexItem indexItem3'><a href='#GetInvoice'>GetInvoice</a>
      <li class='indexItem indexItem3'><a href='#GetInvoiceDetails'>GetInvoiceDetails</a>
      <li class='indexItem indexItem3'><a href='#AddInvoice'>AddInvoice</a>
      <li class='indexItem indexItem3'><a href='#ModInvoice'>ModInvoice</a>
      <li class='indexItem indexItem3'><a href='#CloseInvoice'>CloseInvoice</a>
      <li class='indexItem indexItem3'><a href='#ReopenInvoice'>ReopenInvoice</a>
      <li class='indexItem indexItem3'><a href='#DelInvoice'>DelInvoice</a>
      <li class='indexItem indexItem3'><a href='#MergeInvoices'>MergeInvoices</a>
      <li class='indexItem indexItem3'><a href='#GetBiblioCountByBasketno'>GetBiblioCountByBasketno</a>
      <li class='indexItem indexItem3'><a href='#GetOrderUsers'>GetOrderUsers</a>
      <li class='indexItem indexItem3'><a href='#ModOrderUsers'>ModOrderUsers</a>
      <li class='indexItem indexItem3'><a href='#FillWithDefaultValues'>FillWithDefaultValues</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>C4::Acquisition - Koha functions for dealing with orders and acquisitions</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>use C4::Acquisition;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The functions in this module deal with acquisitions,
managing book orders,
basket and parcels.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS_ABOUT_BASKETS"
>FUNCTIONS ABOUT BASKETS</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasket"
>GetBasket</a></h3>

<pre>  $aqbasket = &#38;GetBasket($basketnumber);</pre>

<p>get all basket informations in aqbasket for a given basket</p>

<p><b>returns:</b> informations for a given basket returned as a hashref.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="NewBasket"
>NewBasket</a></h3>

<pre>  $basket = &#38;NewBasket( $booksellerid, $authorizedby, $basketname,
      $basketnote, $basketbooksellernote, $basketcontractnumber, $deliveryplace, $billingplace, $is_standing, $create_items );</pre>

<p>Create a new basket in aqbasket table</p>

<dl>
<dt><a name="$booksellerid_is_a_foreign_key_in_the_aqbasket_table"
><code>$booksellerid</code> is a foreign key in the aqbasket table</a></dt>

<dd>
<dt><a name="$authorizedby_is_the_username_of_who_created_the_basket"
><code>$authorizedby</code> is the username of who created the basket</a></dt>
</dl>

<p>The other parameters are optional, see ModBasketHeader for more info on them.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ReopenBasket"
>ReopenBasket</a></h3>

<pre>  &#38;ReopenBasket($basketno);</pre>

<p>reopen a basket</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasketAsCSV"
>GetBasketAsCSV</a></h3>

<pre>  &#38;GetBasketAsCSV($basketno);</pre>

<p>Export a basket as CSV</p>

<p>$cgi parameter is needed for column name translation</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasketGroupAsCSV"
>GetBasketGroupAsCSV</a></h3>

<pre>  &#38;GetBasketGroupAsCSV($basketgroupid);</pre>

<p>Export a basket group as CSV</p>

<p>$cgi parameter is needed for column name translation</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="CloseBasketgroup"
>CloseBasketgroup</a></h3>

<pre>  &#38;CloseBasketgroup($basketgroupno);</pre>

<p>close a basketgroup</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ReOpenBaskergroup($basketgroupno)"
>ReOpenBaskergroup($basketgroupno)</a></h3>

<pre>  &#38;ReOpenBaskergroup($basketgroupno);</pre>

<p>reopen a basketgroup</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModBasket"
>ModBasket</a></h3>

<pre>  &#38;ModBasket($basketinfo);</pre>

<p>Modifies a basket, using a hashref $basketinfo for the relevant information, only $basketinfo-&#62;{&#39;basketno&#39;} is required.</p>

<dl>
<dt><a name="$basketno_is_the_primary_key_of_the_basket_in_the_aqbasket_table."
><code>$basketno</code> is the primary key of the basket in the aqbasket table.</a></dt>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModBasketHeader"
>ModBasketHeader</a></h3>

<pre>  &#38;ModBasketHeader($basketno, $basketname, $note, $booksellernote, $contractnumber, $booksellerid);</pre>

<p>Modifies a basket&#39;s header.</p>

<dl>
<dt><a name="$basketno_is_the_&#34;basketno&#34;_field_in_the_&#34;aqbasket&#34;_table;"
><code>$basketno</code> is the &#34;basketno&#34; field in the &#34;aqbasket&#34; table;</a></dt>

<dd>
<dt><a name="$basketname_is_the_&#34;basketname&#34;_field_in_the_&#34;aqbasket&#34;_table;"
><code>$basketname</code> is the &#34;basketname&#34; field in the &#34;aqbasket&#34; table;</a></dt>

<dd>
<dt><a name="$note_is_the_&#34;note&#34;_field_in_the_&#34;aqbasket&#34;_table;"
><code>$note</code> is the &#34;note&#34; field in the &#34;aqbasket&#34; table;</a></dt>

<dd>
<dt><a name="$booksellernote_is_the_&#34;booksellernote&#34;_field_in_the_&#34;aqbasket&#34;_table;"
><code>$booksellernote</code> is the &#34;booksellernote&#34; field in the &#34;aqbasket&#34; table;</a></dt>

<dd>
<dt><a name="$contractnumber_is_the_&#34;contractnumber&#34;_(foreign)_key_in_the_&#34;aqbasket&#34;_table."
><code>$contractnumber</code> is the &#34;contractnumber&#34; (foreign) key in the &#34;aqbasket&#34; table.</a></dt>

<dd>
<dt><a name="$booksellerid_is_the_id_(foreign)_key_in_the_&#34;aqbooksellers&#34;_table_for_the_vendor."
><code>$booksellerid</code> is the id (foreign) key in the &#34;aqbooksellers&#34; table for the vendor.</a></dt>

<dd>
<dt><a name="$deliveryplace_is_the_&#34;deliveryplace&#34;_field_in_the_aqbasket_table."
><code>$deliveryplace</code> is the &#34;deliveryplace&#34; field in the aqbasket table.</a></dt>

<dd>
<dt><a name="$billingplace_is_the_&#34;billingplace&#34;_field_in_the_aqbasket_table."
><code>$billingplace</code> is the &#34;billingplace&#34; field in the aqbasket table.</a></dt>

<dd>
<dt><a name="$is_standing_is_the_&#34;is_standing&#34;_field_in_the_aqbasket_table."
><code>$is_standing</code> is the &#34;is_standing&#34; field in the aqbasket table.</a></dt>

<dd>
<dt><a 
><code>$create_items</code> should be set to &#39;ordering&#39;, &#39;receiving&#39; or &#39;cataloguing&#39; (or undef, in which case the AcqCreateItem syspref takes precedence).</a></dt>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasketsByBookseller"
>GetBasketsByBookseller</a></h3>

<pre>  @results = &#38;GetBasketsByBookseller($booksellerid, $extra);</pre>

<p>Returns a list of hashes of all the baskets that belong to bookseller &#39;booksellerid&#39;.</p>

<dl>
<dt><a name="$booksellerid_is_the_&#39;id&#39;_field_of_the_bookseller_in_the_aqbooksellers_table"
><code>$booksellerid</code> is the &#39;id&#39; field of the bookseller in the aqbooksellers table</a></dt>

<dd>
<dt><a name="$extra_is_the_extra_sql_parameters,_can_be"
><code>$extra</code> is the extra sql parameters, can be</a></dt>

<dd>
<pre> $extra-&#62;{groupby}: group baskets by column
    ex. $extra-&#62;{groupby} = aqbasket.basketgroupid
 $extra-&#62;{orderby}: order baskets by column
 $extra-&#62;{limit}: limit number of results (can be helpful for pagination)</pre>
</dd>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasketsInfosByBookseller"
>GetBasketsInfosByBookseller</a></h3>

<pre>    my $baskets = GetBasketsInfosByBookseller($supplierid, $allbaskets);</pre>

<p>The optional second parameter allbaskets is a boolean allowing you to select all baskets from the supplier; by default only active baskets (open or closed but still something to receive) are returned.</p>

<p>Returns in a arrayref of hashref all about booksellers baskets, plus: total_biblios: Number of distinct biblios in basket total_items: Number of items in basket expected_items: Number of non-received items in basket</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasketUsers"
>GetBasketUsers</a></h3>

<pre>    $basketusers_ids = &#38;GetBasketUsers($basketno);</pre>

<p>Returns a list of all borrowernumbers that are in basket users list</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModBasketUsers"
>ModBasketUsers</a></h3>

<pre>    my @basketusers_ids = (1, 2, 3);
    &#38;ModBasketUsers($basketno, @basketusers_ids);</pre>

<p>Delete all users from basket users list, and add users in <code>@basketusers_ids</code> to this users list.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="CanUserManageBasket"
>CanUserManageBasket</a></h3>

<pre>    my $bool = CanUserManageBasket($borrower, $basket[, $userflags]);
    my $bool = CanUserManageBasket($borrowernumber, $basketno[, $userflags]);</pre>

<p>Check if a borrower can manage a basket, according to system preference AcqViewBaskets, user permissions and basket properties (creator, users list, branch).</p>

<p>First parameter can be either a borrowernumber or a hashref as returned by Koha::Patron-&#62;unblessed</p>

<p>Second parameter can be either a basketno or a hashref as returned by C4::Acquisition::GetBasket.</p>

<p>The third parameter is optional. If given, it should be a hashref as returned by C4::Auth::getuserflags. If not, getuserflags is called.</p>

<p>If user is authorised to manage basket, returns 1. Otherwise returns 0.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasketsByBasketgroup"
>GetBasketsByBasketgroup</a></h3>

<pre>  $baskets = &#38;GetBasketsByBasketgroup($basketgroupid);</pre>

<p>Returns a reference to all baskets that belong to basketgroup $basketgroupid.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="NewBasketgroup"
>NewBasketgroup</a></h3>

<pre>  $basketgroupid = NewBasketgroup(\%hashref);</pre>

<p>Adds a basketgroup to the aqbasketgroups table, and add the initial baskets to it.</p>

<p>$hashref-&#62;{&#39;booksellerid&#39;} is the &#39;id&#39; field of the bookseller in the aqbooksellers table,</p>

<p>$hashref-&#62;{&#39;name&#39;} is the &#39;name&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;basketlist&#39;} is a list reference of the &#39;id&#39;s of the baskets that belong to this group,</p>

<p>$hashref-&#62;{&#39;billingplace&#39;} is the &#39;billingplace&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;deliveryplace&#39;} is the &#39;deliveryplace&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;freedeliveryplace&#39;} is the &#39;freedeliveryplace&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;deliverycomment&#39;} is the &#39;deliverycomment&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;closed&#39;} is the &#39;closed&#39; field of the aqbasketgroups table, it is false if 0, true otherwise.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModBasketgroup"
>ModBasketgroup</a></h3>

<pre>  ModBasketgroup(\%hashref);</pre>

<p>Modifies a basketgroup in the aqbasketgroups table, and add the baskets to it.</p>

<p>$hashref-&#62;{&#39;id&#39;} is the &#39;id&#39; field of the basketgroup in the aqbasketgroup table, this parameter is mandatory,</p>

<p>$hashref-&#62;{&#39;name&#39;} is the &#39;name&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;basketlist&#39;} is a list reference of the &#39;id&#39;s of the baskets that belong to this group,</p>

<p>$hashref-&#62;{&#39;billingplace&#39;} is the &#39;billingplace&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;deliveryplace&#39;} is the &#39;deliveryplace&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;freedeliveryplace&#39;} is the &#39;freedeliveryplace&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;deliverycomment&#39;} is the &#39;deliverycomment&#39; field of the basketgroup in the aqbasketgroups table,</p>

<p>$hashref-&#62;{&#39;closed&#39;} is the &#39;closed&#39; field of the aqbasketgroups table, it is false if 0, true otherwise.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="DelBasketgroup"
>DelBasketgroup</a></h3>

<pre>  DelBasketgroup($basketgroupid);</pre>

<p>Deletes a basketgroup in the aqbasketgroups table, and removes the reference to it from the baskets,</p>

<dl>
<dt><a name="$basketgroupid_is_the_&#39;id&#39;_field_of_the_basket_in_the_aqbasketgroup_table"
><code>$basketgroupid</code> is the &#39;id&#39; field of the basket in the aqbasketgroup table</a></dt>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS_ABOUT_ORDERS"
>FUNCTIONS ABOUT ORDERS</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasketgroup"
>GetBasketgroup</a></h3>

<pre>  $basketgroup = &#38;GetBasketgroup($basketgroupid);</pre>

<p>Returns a reference to the hash containing all information about the basketgroup.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBasketgroups"
>GetBasketgroups</a></h3>

<pre>  $basketgroups = &#38;GetBasketgroups($booksellerid);</pre>

<p>Returns a reference to the array of all the basketgroups of bookseller $booksellerid.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS_ABOUT_ORDERS"
>FUNCTIONS ABOUT ORDERS</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetOrders"
>GetOrders</a></h3>

<pre>  @orders = &#38;GetOrders( $basketno, { orderby =&#62; &#39;biblio.title&#39;, cancelled =&#62; 0|1 } );</pre>

<p>Looks up the pending (non-cancelled) orders with the given basket number.</p>

<p>If cancelled is set, only cancelled orders will be returned.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetOrdersByBiblionumber"
>GetOrdersByBiblionumber</a></h3>

<pre>  @orders = &#38;GetOrdersByBiblionumber($biblionumber);</pre>

<p>Looks up the orders with linked to a specific $biblionumber, including cancelled orders and received orders.</p>

<p>return : <code>@orders</code> is an array of references-to-hash, whose keys are the fields from the aqorders, biblio, and biblioitems tables in the Koha database.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetOrder"
>GetOrder</a></h3>

<pre>  $order = &#38;GetOrder($ordernumber);</pre>

<p>Looks up an order by order number.</p>

<p>Returns a reference-to-hash describing the order. The keys of <code>$order</code> are fields from the biblio, biblioitems, aqorders tables of the Koha database.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModOrder"
>ModOrder</a></h3>

<pre>  &#38;ModOrder(\%hashref);</pre>

<p>Modifies an existing order. Updates the order with order number $hashref-&#62;{&#39;ordernumber&#39;} and biblionumber $hashref-&#62;{&#39;biblionumber&#39;}. All other keys of the hash update the fields with the same name in the aqorders table of the Koha database.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModItemOrder"
>ModItemOrder</a></h3>

<pre>    ModItemOrder($itemnumber, $ordernumber);</pre>

<p>Modifies the ordernumber of an item in aqorders_items.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModReceiveOrder"
>ModReceiveOrder</a></h3>

<pre>    my ( $date_received, $new_ordernumber ) = ModReceiveOrder(
        {
            biblionumber         =&#62; $biblionumber,
            order                =&#62; $order,
            quantityreceived     =&#62; $quantityreceived,
            user                 =&#62; $user,
            invoice              =&#62; $invoice,
            budget_id            =&#62; $budget_id,
            datereceived         =&#62; $datereceived,
            received_itemnumbers =&#62; \@received_itemnumbers,
        }
    );</pre>

<p>Updates an order, to reflect the fact that it was received, at least in part.</p>

<p>If a partial order is received, splits the order into two.</p>

<p>Updates the order with biblionumber <code>$biblionumber</code> and ordernumber <code>$order-</code>{ordernumber}&#62;.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="CancelReceipt"
>CancelReceipt</a></h3>

<pre>    my $parent_ordernumber = CancelReceipt($ordernumber);

    Cancel an order line receipt and update the parent order line, as if no
    receipt was made.
    If items are created at receipt (AcqCreateItem = receiving) then delete
    these items.</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="SearchOrders"
>SearchOrders</a></h3>

<p>@results = &#38;SearchOrders({ ordernumber =&#62; $ordernumber, search =&#62; $search, ean =&#62; $ean, booksellerid =&#62; $booksellerid, basketno =&#62; $basketno, basketname =&#62; $basketname, basketgroupname =&#62; $basketgroupname, owner =&#62; $owner, pending =&#62; $pending ordered =&#62; $ordered biblionumber =&#62; $biblionumber, budget_id =&#62; $budget_id });</p>

<p>Searches for orders filtered by criteria.</p>

<p><code>$ordernumber</code> Finds matching orders or transferred orders by ordernumber. <code>$search</code> Finds orders matching %$search% in title, author, or isbn. <code>$owner</code> Finds order for the logged in user. <code>$pending</code> Finds pending orders. Ignores completed and cancelled orders. <code>$ordered</code> Finds orders to receive only (status &#39;ordered&#39; or &#39;partial&#39;).</p>

<p><code>@results</code> is an array of references-to-hash with the keys are fields from aqorders, biblio, biblioitems and aqbasket tables.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="TransferOrder"
>TransferOrder</a></h3>

<pre>    my $newordernumber = TransferOrder($ordernumber, $basketno);</pre>

<p>Transfer an order line to a basket. Mark $ordernumber as cancelled with an internal note &#39;Cancelled and transferred to BOOKSELLER on DATE&#39; and create new order with internal note &#39;Transferred from BOOKSELLER on DATE&#39;. Move all attached items to the new order. Received orders cannot be transferred. Return the ordernumber of created order.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_rounding_sql"
>get_rounding_sql</a></h3>

<pre>    $rounding_sql = get_rounding_sql($column_name);</pre>

<p>returns the correct SQL routine based on OrderPriceRounding system preference.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_rounded_price"
>get_rounded_price</a></h3>

<pre>    $rounded_price = get_rounded_price( $price );</pre>

<p>returns a price rounded as specified in OrderPriceRounding system preference.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetHistory"
>GetHistory</a></h3>

<pre>  \@order_loop = GetHistory( %params );</pre>

<p>Retreives some acquisition history information</p>

<p>params: title author name isbn ean from_placed_on to_placed_on basket - search both basket name and number booksellerinvoicenumber basketgroupname budget orderstatus (note that orderstatus &#39;&#39; will retrieve orders of any status except cancelled) is_standing managing_library biblionumber get_canceled_order (if set to a true value, cancelled orders will be included)</p>

<p>returns: $order_loop is a list of hashrefs that each look like this: { &#39;author&#39; =&#62; &#39;Twain, Mark&#39;, &#39;basketno&#39; =&#62; &#39;1&#39;, &#39;biblionumber&#39; =&#62; &#39;215&#39;, &#39;count&#39; =&#62; 1, &#39;creationdate&#39; =&#62; &#39;MM/DD/YYYY&#39;, &#39;datereceived&#39; =&#62; undef, &#39;ecost&#39; =&#62; &#39;1.00&#39;, &#39;id&#39; =&#62; &#39;1&#39;, &#39;invoicenumber&#39; =&#62; undef, &#39;name&#39; =&#62; &#39;&#39;, &#39;ordernumber&#39; =&#62; &#39;1&#39;, &#39;quantity&#39; =&#62; 1, &#39;quantityreceived&#39; =&#62; undef, &#39;title&#39; =&#62; &#39;The Adventures of Huckleberry Finn&#39;, &#39;managing_library&#39; =&#62; &#39;CPL&#39; &#39;is_standing&#39; =&#62; &#39;1&#39; }</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetRecentAcqui"
>GetRecentAcqui</a></h2>

<pre>  $results = GetRecentAcqui($days);</pre>

<p><code>$results</code> is a ref to a table which contains hashref</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="AddClaim"
>AddClaim</a></h3>

<pre>  &#38;AddClaim($ordernumber);</pre>

<p>Add a claim for an order</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetInvoices"
>GetInvoices</a></h3>

<pre>    my @invoices = GetInvoices(
        invoicenumber =&#62; $invoicenumber,
        supplierid =&#62; $supplierid,
        suppliername =&#62; $suppliername,
        shipmentdatefrom =&#62; $shipmentdatefrom, # ISO format
        shipmentdateto =&#62; $shipmentdateto, # ISO format
        billingdatefrom =&#62; $billingdatefrom, # ISO format
        billingdateto =&#62; $billingdateto, # ISO format
        isbneanissn =&#62; $isbn_or_ean_or_issn,
        title =&#62; $title,
        author =&#62; $author,
        publisher =&#62; $publisher,
        publicationyear =&#62; $publicationyear,
        branchcode =&#62; $branchcode,
        order_by =&#62; $order_by
    );</pre>

<p>Return a list of invoices that match all given criteria.</p>

<p>$order_by is &#34;column_name (asc|desc)&#34;, where column_name is any of &#39;invoicenumber&#39;, &#39;booksellerid&#39;, &#39;shipmentdate&#39;, &#39;billingdate&#39;, &#39;closedate&#39;, &#39;shipmentcost&#39;, &#39;shipmentcost_budgetid&#39;.</p>

<p>asc is the default if omitted</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetInvoice"
>GetInvoice</a></h3>

<pre>    my $invoice = GetInvoice($invoiceid);</pre>

<p>Get informations about invoice with given $invoiceid</p>

<p>Return a hash filled with aqinvoices.* fields</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetInvoiceDetails"
>GetInvoiceDetails</a></h3>

<pre>    my $invoice = GetInvoiceDetails($invoiceid)</pre>

<p>Return informations about an invoice + the list of related order lines</p>

<p>Orders informations are in $invoice-&#62;{orders} (array ref)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="AddInvoice"
>AddInvoice</a></h3>

<pre>    my $invoiceid = AddInvoice(
        invoicenumber =&#62; $invoicenumber,
        booksellerid =&#62; $booksellerid,
        shipmentdate =&#62; $shipmentdate,
        billingdate =&#62; $billingdate,
        closedate =&#62; $closedate,
        shipmentcost =&#62; $shipmentcost,
        shipmentcost_budgetid =&#62; $shipmentcost_budgetid
    );</pre>

<p>Create a new invoice and return its id or undef if it fails.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModInvoice"
>ModInvoice</a></h3>

<pre>    ModInvoice(
        invoiceid =&#62; $invoiceid,    # Mandatory
        invoicenumber =&#62; $invoicenumber,
        booksellerid =&#62; $booksellerid,
        shipmentdate =&#62; $shipmentdate,
        billingdate =&#62; $billingdate,
        closedate =&#62; $closedate,
        shipmentcost =&#62; $shipmentcost,
        shipmentcost_budgetid =&#62; $shipmentcost_budgetid
    );</pre>

<p>Modify an invoice, invoiceid is mandatory.</p>

<p>Return undef if it fails.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="CloseInvoice"
>CloseInvoice</a></h3>

<pre>    CloseInvoice($invoiceid);</pre>

<p>Close an invoice.</p>

<p>Equivalent to ModInvoice(invoiceid =&#62; $invoiceid, closedate =&#62; undef);</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ReopenInvoice"
>ReopenInvoice</a></h3>

<pre>    ReopenInvoice($invoiceid);</pre>

<p>Reopen an invoice</p>

<p>Equivalent to ModInvoice(invoiceid =&#62; $invoiceid, closedate =&#62; $closedate );</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="DelInvoice"
>DelInvoice</a></h3>

<pre>    DelInvoice($invoiceid);</pre>

<p>Delete an invoice if there are no items attached to it.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="MergeInvoices"
>MergeInvoices</a></h3>

<pre>    MergeInvoices($invoiceid, \@sourceids);</pre>

<p>Merge the invoices identified by the IDs in \@sourceids into the invoice identified by $invoiceid.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetBiblioCountByBasketno"
>GetBiblioCountByBasketno</a></h3>

<p>$biblio_count = &#38;GetBiblioCountByBasketno($basketno);</p>

<p>Looks up the biblio&#39;s count that has basketno value $basketno</p>

<p>Returns a quantity</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="GetOrderUsers"
>GetOrderUsers</a></h3>

<pre>    $order_users_ids = &#38;GetOrderUsers($ordernumber);</pre>

<p>Returns a list of all borrowernumbers that are in order users list</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ModOrderUsers"
>ModOrderUsers</a></h3>

<pre>    my @order_users_ids = (1, 2, 3);
    &#38;ModOrderUsers($ordernumber, @basketusers_ids);</pre>

<p>Delete all users from order users list, and add users in <code>@order_users_ids</code> to this users list.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="FillWithDefaultValues"
>FillWithDefaultValues</a></h3>

<p>FillWithDefaultValues( $marc_record, $params );</p>

<p>This will update the record with default value defined in the ACQ framework. For all existing fields, if a default value exists and there are no subfield, it will be created. If the field does not exist, it will be created too.</p>

<p>If the parameter only_mandatory =&#62; 1 is passed via $params, only the mandatory defaults are being applied to the record.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Koha Development Team &#60;http://koha-community.org/&#62;</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
