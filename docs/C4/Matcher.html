<html><head><title>C4::Matcher</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Sat Oct  5 18:05:57 2024 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#GetMatcherList'>GetMatcherList</a>
    <li class='indexItem indexItem2'><a href='#GetMatcherId'>GetMatcherId</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new'>new</a>
    <li class='indexItem indexItem2'><a href='#fetch'>fetch</a>
    <li class='indexItem indexItem2'><a href='#store'>store</a>
    <li class='indexItem indexItem2'><a href='#delete'>delete</a>
    <li class='indexItem indexItem2'><a href='#record_type'>record_type</a>
    <li class='indexItem indexItem2'><a href='#threshold'>threshold</a>
    <li class='indexItem indexItem2'><a href='#_id'>_id</a>
    <li class='indexItem indexItem2'><a href='#code'>code</a>
    <li class='indexItem indexItem2'><a href='#description'>description</a>
    <li class='indexItem indexItem2'><a href='#add_matchpoint'>add_matchpoint</a>
    <li class='indexItem indexItem2'><a href='#add_simple_matchpoint'>add_simple_matchpoint</a>
    <li class='indexItem indexItem2'><a href='#add_required_check'>add_required_check</a>
    <li class='indexItem indexItem2'><a href='#add_simple_required_check'>add_simple_required_check</a>
    <li class='indexItem indexItem2'><a href='#get_matches'>get_matches</a>
    <li class='indexItem indexItem2'><a href='#dump'>dump</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>C4::Matcher - find MARC records matching another one</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  my @matchers = C4::Matcher::GetMatcherList();

  my $matcher = C4::Matcher-&#62;new($record_type);
  $matcher-&#62;threshold($threshold);
  $matcher-&#62;code($code);
  $matcher-&#62;description($description);

  $matcher-&#62;add_simple_matchpoint(&#39;isbn&#39;, 1000, &#39;020&#39;, &#39;a&#39;, -1, 0, &#39;&#39;);
  $matcher-&#62;add_simple_matchpoint(&#39;Date&#39;, 1000, &#39;008&#39;, &#39;&#39;, 7, 4, &#39;&#39;);
  $matcher-&#62;add_matchpoint(&#39;isbn&#39;, 1000, [ { tag =&#62; &#39;020&#39;, subfields =&#62; &#39;a&#39;, norms =&#62; [] } ]);

  $matcher-&#62;add_simple_required_check(&#39;245&#39;, &#39;a&#39;, -1, 0, &#39;&#39;, &#39;245&#39;, &#39;a&#39;, -1, 0, &#39;&#39;);
  $matcher-&#62;add_required_check([ { tag =&#62; &#39;245&#39;, subfields =&#62; &#39;a&#39;, norms =&#62; [] } ],
                               [ { tag =&#62; &#39;245&#39;, subfields =&#62; &#39;a&#39;, norms =&#62; [] } ]);

  my @matches = $matcher-&#62;get_matches($marc_record, $max_matches);

  foreach $match (@matches) {

      # matches already sorted in order of
      # decreasing score
      print &#34;record ID: $match-&#62;{&#39;record_id&#39;};
      print &#34;score:     $match-&#62;{&#39;score&#39;};

  }

  my $matcher_description = $matcher-&#62;dump();</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetMatcherList"
>GetMatcherList</a></h2>

<pre>  my @matchers = C4::Matcher::GetMatcherList();</pre>

<p>Returns an array of hashrefs list all matchers present in the database. Each hashref includes:</p>

<pre> * matcher_id
 * code
 * description</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetMatcherId"
>GetMatcherId</a></h2>

<pre>  my $matcher_id = C4::Matcher::GetMatcherId($code);</pre>

<p>Returns the matcher_id of a code.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new"
>new</a></h2>

<pre>  my $matcher = C4::Matcher-&#62;new($record_type, $threshold);</pre>

<p>Creates a new Matcher. <code>$record_type</code> indicates which search database to use, e.g., &#39;biblio&#39; or &#39;authority&#39; and defaults to &#39;biblio&#39;, while <code>$threshold</code> is the minimum score required for a match and defaults to 1000.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="fetch"
>fetch</a></h2>

<pre>  my $matcher = C4::Matcher-&#62;fetch($id);</pre>

<p>Creates a matcher object from the version stored in the database. If a matcher with the given id does not exist, returns undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="store"
>store</a></h2>

<pre>  my $id = $matcher-&#62;store();</pre>

<p>Stores matcher in database. The return value is the ID of the marc_matchers row. If the matcher was previously retrieved from the database via the fetch() method, the DB representation of the matcher is replaced.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="delete"
>delete</a></h2>

<pre>  C4::Matcher-&#62;delete($id);</pre>

<p>Deletes the matcher of the specified ID from the database.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="record_type"
>record_type</a></h2>

<pre>  $matcher-&#62;record_type(&#39;biblio&#39;);
  my $record_type = $matcher-&#62;record_type();</pre>

<p>Accessor method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="threshold"
>threshold</a></h2>

<pre>  $matcher-&#62;threshold(1000);
  my $threshold = $matcher-&#62;threshold();</pre>

<p>Accessor method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_id"
>_id</a></h2>

<pre>  $matcher-&#62;_id(123);
  my $id = $matcher-&#62;_id();</pre>

<p>Accessor method. Note that using this method to set the DB ID of the matcher should not be done outside of the editing CGI.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="code"
>code</a></h2>

<pre>  $matcher-&#62;code(&#39;ISBN&#39;);
  my $code = $matcher-&#62;code();</pre>

<p>Accessor method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="description"
>description</a></h2>

<pre>  $matcher-&#62;description(&#39;match on ISBN&#39;);
  my $description = $matcher-&#62;description();</pre>

<p>Accessor method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_matchpoint"
>add_matchpoint</a></h2>

<pre>  $matcher-&#62;add_matchpoint($index, $score, $matchcomponents);</pre>

<p>Adds a matchpoint that may include multiple components. The $index parameter identifies the index that will be searched, while $score is the weight that will be added if a match is found.</p>

<p>$matchcomponents should be a reference to an array of matchpoint compoents, each of which should be a hash containing the following keys: tag subfields offset length norms</p>

<p>The normalization_rules value should in turn be a reference to an array, each element of which should be a reference to a normalization subroutine (under C4::Normalize) to be applied to the source string.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_simple_matchpoint"
>add_simple_matchpoint</a></h2>

<pre>  $matcher-&#62;add_simple_matchpoint($index, $score, $source_tag,
                            $source_subfields, $source_offset, 
                            $source_length, $source_normalizer);</pre>

<p>Adds a simple matchpoint rule -- after composing a key based on the source tag and subfields, normalized per the normalization fuction, search the index. All records retrieved will receive the assigned score.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_required_check"
>add_required_check</a></h2>

<pre>  $match-&#62;add_required_check($source_matchpoint, $target_matchpoint);</pre>

<p>Adds a required check definition. A required check means that in order for a match to be considered valid, the key derived from the source (incoming) record must match the key derived from the target (already in DB) record.</p>

<p>Unlike a regular matchpoint, only the first repeat of each tag in the source and target match criteria are considered.</p>

<p>A typical example of a required check would be verifying that the titles and publication dates match.</p>

<p>$source_matchpoint and $target_matchpoint are each a reference to an array of hashes, where each hash follows the same definition as the matchpoint component specification in add_matchpoint, i.e.,</p>

<pre>    tag
    subfields
    offset
    length
    norms</pre>

<p>The normalization_rules value should in turn be a reference to an array, each element of which should be a reference to a normalization subroutine (under C4::Normalize) to be applied to the source string.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_simple_required_check"
>add_simple_required_check</a></h2>

<pre>  $matcher-&#62;add_simple_required_check($source_tag, $source_subfields,
                $source_offset, $source_length, $source_normalizer, 
                $target_tag, $target_subfields, $target_offset, 
                $target_length, $target_normalizer);</pre>

<p>Adds a required check, which requires that the normalized keys made from the source and targets must match for a match to be considered valid.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_matches"
>get_matches</a></h2>

<pre>  my @matches = $matcher-&#62;get_matches($marc_record, $max_matches);
  foreach $match (@matches) {
      # matches already sorted in order of
      # decreasing score
      print &#34;record ID: $match-&#62;{&#39;record_id&#39;};
      print &#34;score:     $match-&#62;{&#39;score&#39;};
  }</pre>

<p>Identifies all of the records matching the given MARC record. For a record already in the database to be considered a match, it must meet the following criteria:</p>

<dl>
<dt><a name="1._Total_score_from_its_matching_field_must_exceed_the_supplied_threshold."
>1. Total score from its matching field must exceed the supplied threshold.</a></dt>

<dd>
<dt><a name="2._It_must_pass_all_required_checks."
>2. It must pass all required checks.</a></dt>
</dl>

<p>Only the top $max_matches matches are returned. The returned array is sorted in order of decreasing score, i.e., the best match is first.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="dump"
>dump</a></h2>

<pre>  $description = $matcher-&#62;dump();</pre>

<p>Returns a reference to a structure containing all of the information in the matcher object. This is mainly a convenience method to aid setting up a HTML editing form.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Koha Development Team &#60;http://koha-community.org/&#62;</p>

<p>Galen Charlton &#60;galen.charlton@liblime.com&#62;</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
