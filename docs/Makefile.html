<html><head><title>Makefile.PL</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="_blkbluw.css" media="all" >

<script type="text/javascript" src="_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Sun Feb 12 01:17:19 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#BASIC_INSTALLATION'>BASIC INSTALLATION</a>
    <li class='indexItem indexItem2'><a href='#UPGRADE_INSTALLATION'>UPGRADE INSTALLATION</a>
    <li class='indexItem indexItem2'><a href='#PACKAGING_RELEASE_TARBALLS'>PACKAGING RELEASE TARBALLS</a>
    <li class='indexItem indexItem2'><a href='#CLEANING_UP'>CLEANING UP</a>
    <li class='indexItem indexItem2'><a href='#CLI_PARAMETERS'>CLI PARAMETERS</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#VARIABLES'>VARIABLES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#NAME%2C_VERSION_FROM%2C_ABSTRACT%2C_AUTHOR'>NAME, VERSION_FROM, ABSTRACT, AUTHOR</a>
    <li class='indexItem indexItem2'><a href='#NO_META'>NO_META</a>
    <li class='indexItem indexItem2'><a href='#PREREQ_PM'>PREREQ_PM</a>
    <li class='indexItem indexItem2'><a href='#PM'>PM</a>
    <li class='indexItem indexItem2'><a href='#PL_FILES'>PL_FILES</a>
    <li class='indexItem indexItem2'><a href='#target_map'>target_map</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#CONFIGURATION_OPTIONS'>CONFIGURATION OPTIONS</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#hashdir'>hashdir</a>
    <li class='indexItem indexItem2'><a href='#get_file_map'>get_file_map</a>
    <li class='indexItem indexItem2'><a href='#get_cli_values'>get_cli_values</a>
    <li class='indexItem indexItem2'><a href='#get_install_log_values'>get_install_log_values</a>
    <li class='indexItem indexItem2'><a href='#get_configuration'>get_configuration</a>
    <li class='indexItem indexItem2'><a href='#get_target_directories'>get_target_directories</a>
    <li class='indexItem indexItem2'><a href='#get_test_dir'>get_test_dir</a>
    <li class='indexItem indexItem2'><a href='#find_zebra'>find_zebra</a>
    <li class='indexItem indexItem2'><a href='#_update_zebra_conf_target'>_update_zebra_conf_target</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Makefile.PL - Koha packager and installer</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BASIC_INSTALLATION"
>BASIC INSTALLATION</a></h2>

<pre>    perl Makefile.PL
    make
    make test
    sudo make install</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="UPGRADE_INSTALLATION"
>UPGRADE INSTALLATION</a></h2>

<pre>    NOTE: This option is only available if koha-install-log exists.

    perl Makefile.PL --prev-install-log /path/to/koha-install-log

    make
    make test
    sudo make upgrade</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="PACKAGING_RELEASE_TARBALLS"
>PACKAGING RELEASE TARBALLS</a></h2>

<pre>    make manifest tardist
    make manifest zipdist</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CLEANING_UP"
>CLEANING UP</a></h2>

<pre>        make clean</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CLI_PARAMETERS"
>CLI PARAMETERS</a></h2>

<pre>    --prev-install-log           Read configuration from previous installation
    --install_mode               Installation mode (dev, standard, single)
    --db_type                    Database (mysql, Pg)
    --db_host                    Database host (e.g. localhost)
    --db_port                    Database port (e.g. 3306)
    --db_name                    Database name (e.g. koha)
    --db_user                    Database user (e.g. kohaadmin)
    --db_pass                    Database password (e.g. katikoan)
    --zebra_marc_format          Zebra MARC format (marc21, unimarc)
    --zebra_language             Zebra language (e.g. en)
    --zebra_tokenizer            Zebra tokenizer (chr, icu)
    --zebra_user                 Zebra user (e.g. kohauser)
    --zebra_pass                 Zebra password (e.g. zebrastripes)
    --zebra_sru_host             Zebra SRU servername (e.g. localhost)
    --zebra_sru_biblios_port     Zebra SRU biblios port (e.g. 9998)
    --zebra_sru_authorities_port Zebra SRU biblios port (e.g. 9999)
    --koha_user                  Koha Unix user (e.g. koha)
    --koha_group                 Koha Unix group (e.g. koha)
    --install_sru                Install the SRU server (yes, no)
    --use_memcached              Use Memcached (yes, no)
    --font_dir                   Location of fonts (e.g. /usr/share/fonts/truetype/dejavu)
    --run_database_tests         Run database dependent tests (yes, no)
    --install_base               Base directory of installation (e.g. /usr/share/koha)
    --template-cache-dir         Specify a template cache directory (e.g. /var/cache/koha)
    --help                       Display this help message</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This is a packager and installer that uses ExtUtils::MakeMaker, which is fairly common on perl systems. As well as building tar or zip files and installing with the above commands, it allows us to check pre-requisites and generate configuration files.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VARIABLES"
>VARIABLES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="NAME,_VERSION_FROM,_ABSTRACT,_AUTHOR"
>NAME, VERSION_FROM, ABSTRACT, AUTHOR</a></h2>

<p>Basic metadata about this software.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="NO_META"
>NO_META</a></h2>

<p>Suppress generation of META.yml file.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="PREREQ_PM"
>PREREQ_PM</a></h2>

<p>Hash of perl modules and versions required.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="PM"
>PM</a></h2>

<p>Hash of file mappings</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="PL_FILES"
>PL_FILES</a></h2>

<p>This is a hash of PL scripts to run after installation and the files to ask them to generate. Maybe use the values from CONFIGURE to generate initial configuration files in future.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="target_map"
>target_map</a></h2>

<p>This is a hash mapping directories and files in the source tree to installation target directories. The rules for this mapping are:</p>

<dl>
<dt><a name="If_a_directory_or_file_is_specified,_it_and_its_contents_will_be_copied_to_the_installation_target_directory."
>If a directory or file is specified, it and its contents will be copied to the installation target directory.</a></dt>

<dd>
<dt><a name="If_a_subdirectory_of_a_mapped_directory_is_specified,_its_target_overrides_the_parent&#39;s_target_for_that_subdirectory."
>If a subdirectory of a mapped directory is specified, its target overrides the parent&#39;s target for that subdirectory.</a></dt>

<dd>
<dt><a 
>The value of each map entry may either be a scalar containing one target or a reference to a hash containing &#39;target&#39; and &#39;trimdir&#39; keys.</a></dt>

<dd>
<dt><a name="Any_files_at_the_top_level_of_the_source_tree_that_are_not_included_in_the_map_will_not_be_installed."
>Any files at the top level of the source tree that are not included in the map will not be installed.</a></dt>

<dd>
<dt><a 
>Any directories at the top level of the source tree that are not included in the map will be installed in INTRANET_CGI_DIR. This is a sensible default given the current organization of the source tree, but (FIXME) it would be better to reorganize the source tree to better match the installation system, to allow adding new directories without having to adjust Makefile.PL each time. The idea is to make the <code>$target_map</code> hash as minimal as possible.</a></dt>
</dl>

<p>The permitted installation targets are:</p>

<dl>
<dt><a name="INTRANET_CGI_DIR"
>INTRANET_CGI_DIR</a></dt>

<dd>
<p>CGI scripts for intranet (staff) interface.</p>

<dt><a name="INTRANET_TMPL_DIR"
>INTRANET_TMPL_DIR</a></dt>

<dd>
<p>HTML templates for the intranet interface.</p>

<dt><a name="INTRANET_WWW_DIR"
>INTRANET_WWW_DIR</a></dt>

<dd>
<p>HTML files, images, etc. for DocumentRoot for the intranet interface.</p>

<dt><a name="OPAC_CGI_DIR"
>OPAC_CGI_DIR</a></dt>

<dd>
<p>CGI scripts for OPAC (public) interface.</p>

<dt><a name="OPAC_TMPL_DIR"
>OPAC_TMPL_DIR</a></dt>

<dd>
<p>HTML templates for the OPAC interface.</p>

<dt><a name="OPAC_WWW_DIR"
>OPAC_WWW_DIR</a></dt>

<dd>
<p>HTML files, images, etc. for DocumentRoot for the OPAC interface.</p>

<dt><a name="PERL_MODULE_DIR"
>PERL_MODULE_DIR</a></dt>

<dd>
<p>Perl modules (at present just the C4 modules) that are intimately tied to Koha. Depending on the installation options, these may or may not be installed one of the standard directories in Perl&#39;s default @LIB.</p>

<dt><a name="KOHA_CONF_DIR"
>KOHA_CONF_DIR</a></dt>

<dd>
<p>Directory for Koha configuration files.</p>

<dt><a name="ZEBRA_CONF_DIR"
>ZEBRA_CONF_DIR</a></dt>

<dd>
<p>Directory for Zebra configuration files.</p>

<dt><a name="ZEBRA_LOCK_DIR"
>ZEBRA_LOCK_DIR</a></dt>

<dd>
<p>Directory for Zebra&#39;s lock files. This includes subdirs for authorities, biblios, and the zebra rebuild function. Any activity to reindex zebra from koha should interlock here with rebuild_zebra.pl.</p>

<dt><a name="ZEBRA_DATA_DIR"
>ZEBRA_DATA_DIR</a></dt>

<dd>
<p>Directory for Zebra&#39;s data files.</p>

<dt><a name="ZEBRA_RUN_DIR"
>ZEBRA_RUN_DIR</a></dt>

<dd>
<p>Directory for Zebra&#39;s UNIX-domain sockets.</p>

<dt><a name="ELASTICSEARCH_SERVERS"
>ELASTICSEARCH_SERVERS</a></dt>

<dd>
<p>Server:port of the Elasticsearch server to use, as a comma separated list: eg. 192.168.0.100:9200, localhost:9200</p>

<dt><a name="ELASTICSEARCH_INDEX"
>ELASTICSEARCH_INDEX</a></dt>

<dd>
<p>Unique index in Elasticsearch, for this Koha-instance eg. koha-mykoha or just koha</p>

<dt><a name="MISC_DIR"
>MISC_DIR</a></dt>

<dd>
<p>Directory for for miscellaenous scripts, among other things the translation toolkit and RSS feed tools.</p>

<dt><a name="SCRIPT_DIR"
>SCRIPT_DIR</a></dt>

<dd>
<p>Directory for command-line scripts and daemons to be set up all for installation modes.</p>

<dt><a name="SCRIPT_NONDEV_DIR"
>SCRIPT_NONDEV_DIR</a></dt>

<dd>
<p>Directory for command-line scripts that should be installed in the same directory as the SCRIPT_DIR target except &#39;dev&#39; installs.</p>

<dt><a name="MAN_DIR"
>MAN_DIR</a></dt>

<dd>
<p>Directory for man pages created from POD -- will mostly contain information of interest to Koha developers.</p>

<dt><a name="DOC_DIR"
>DOC_DIR</a></dt>

<dd>
<p>Directory for Koha documentation accessed from the command-line, e.g., READMEs.</p>

<dt><a name="LOCK_DIR"
>LOCK_DIR</a></dt>

<dd>
<p>Directory for Koha scripts to put their locks.</p>

<dt><a name="LOG_DIR"
>LOG_DIR</a></dt>

<dd>
<p>Directory for Apache and Zebra logs produced by Koha.</p>

<dt><a name="BACKUP_DIR"
>BACKUP_DIR</a></dt>

<dd>
<p>Directory for backup files produced by Koha.</p>

<dt><a name="PLUGINS_DIR"
>PLUGINS_DIR</a></dt>

<dd>
<p>Directory for external Koha plugins.</p>

<dt><a name="FONT_DIR"
>FONT_DIR</a></dt>

<dd>
<p>Directory where DejaVu fonts are installed.</p>

<dt><a name="NONE"
>NONE</a></dt>

<dd>
<p>This is a dummy target used to explicitly state that a given file or directory is not to be installed. This is used either for parts of the installer itself or for development tools that are not applicable to a production installation.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIGURATION_OPTIONS"
>CONFIGURATION OPTIONS</a></h1>

<p>The following configuration options are used by the installer.</p>

<dl>
<dt><a name="INSTALL_MODE"
>INSTALL_MODE</a></dt>

<dd>
<p>Specifies whether installation will be FHS-compliant (default, assumes user has root), put everything under a single directory (for users installing on a web host that allows CGI scripts and a MySQL database but not root access), or development (for a developer who wants to run Koha from a git clone with no fuss).</p>

<dt><a name="INSTALL_BASE"
>INSTALL_BASE</a></dt>

<dd>
<p>Directory under which most components will go. Default value will vary depending on INSTALL_MODE.</p>

<dt><a name="DB_TYPE"
>DB_TYPE</a></dt>

<dd>
<p>Type of DBMS (e.g., mysql or Pg).</p>

<dt><a name="DB_HOST"
>DB_HOST</a></dt>

<dd>
<p>Name of DBMS server.</p>

<dt><a name="DB_PORT"
>DB_PORT</a></dt>

<dd>
<p>Port that DBMS server is listening on.</p>

<dt><a name="DB_NAME"
>DB_NAME</a></dt>

<dd>
<p>Name of the DBMS database for Koha.</p>

<dt><a name="DB_USER"
>DB_USER</a></dt>

<dd>
<p>Name of DBMS user account for Koha&#39;s database.</p>

<dt><a name="DB_PASS"
>DB_PASS</a></dt>

<dd>
<p>Pasword of DMBS user account for Koha&#39;s database.</p>

<dt><a name="ZEBRA_MARC_FORMAT"
>ZEBRA_MARC_FORMAT</a></dt>

<dd>
<p>Specifies format of MARC records to be indexed by Zebra.</p>

<dt><a name="ZEBRA_LANGUAGE"
>ZEBRA_LANGUAGE</a></dt>

<dd>
<p>Specifies primary language of records that will be indexed by Zebra.</p>

<dt><a name="ZEBRA_USER"
>ZEBRA_USER</a></dt>

<dd>
<p>Internal Zebra user account for the index.</p>

<dt><a name="ZEBRA_PASS"
>ZEBRA_PASS</a></dt>

<dd>
<p>Internal Zebra user account&#39;s password.</p>

<dt><a name="KOHA_USER"
>KOHA_USER</a></dt>

<dd>
<p>System user account that will own Koha&#39;s files.</p>

<dt><a name="KOHA_GROUP"
>KOHA_GROUP</a></dt>

<dd>
<p>System group that will own Koha&#39;s files.</p>

<dt><a name="SMTP_HOST"
>SMTP_HOST</a></dt>

<dd>
<p>SMTP server host name (default: localhost)</p>

<dt><a name="SMTP_PORT"
>SMTP_PORT</a></dt>

<dd>
<p>SMTP server port (default: 25)</p>

<dt><a name="SMTP_TIMEOUT"
>SMTP_TIMEOUT</a></dt>

<dd>
<p>Connection timeour in seconds (default: 120)</p>

<dt><a name="SMTP_SSL_MODE"
>SMTP_SSL_MODE</a></dt>

<dd>
<p>SSL mode. Options are &#39;disabled&#39; (default), &#39;ssl&#39; and &#39;starttls&#39;</p>

<dt><a name="SMTP_USER_NAME"
>SMTP_USER_NAME</a></dt>

<dd>
<p>SMTP authentication user name</p>

<dt><a name="SMTP_PASSWORD"
>SMTP_PASSWORD</a></dt>

<dd>
<p>SMTP authentication password</p>

<dt><a name="SMTP_DEBUG"
>SMTP_DEBUG</a></dt>

<dd>
<p>Enable debug mode for SMTP (default: no)</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="hashdir"
>hashdir</a></h2>

<p>This function recurses through the directory structure and builds a hash of hashes containing the structure with arrays holding filenames. This directory hashing routine was taken from BrowserUK @ http://www.perlmonks.org/?node_id=219919</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_file_map"
>get_file_map</a></h2>

<p>This function combines the target_map and file hash to map each source file to its destination relative to the set of installation targets.</p>

<p>Output will be a hash mapping from each source file to its destination value, like this:</p>

<p>&#39;mainpage.pl&#39; =&#62; &#39;$(INTRANET_CGI_DIR)/mainpage.pl&#39;</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_cli_values"
>get_cli_values</a></h2>

<p>Reads values provided on cli for configuration values</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_install_log_values"
>get_install_log_values</a></h2>

<p>Reads value from the Koha install log specified by --prev-install-log</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_configuration"
>get_configuration</a></h2>

<p>This prompts the user for various configuration options.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_target_directories"
>get_target_directories</a></h2>

<p>Creates a hash mapping from symbols for installation target directories to actual directory paths.</p>

<p>Also returns a hash indicating targets for which files need not be copied -- this is used for the &#39;dev&#39; mode installation, where some files are installed in place.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_test_dir"
>get_test_dir</a></h2>

<p>Map a directory target to the corresponding path for the test suite.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="find_zebra"
>find_zebra</a></h2>

<p>Attempt to find Zebra - check user&#39;s PATH and a few other directories for zebrasrv and zebraidx.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_update_zebra_conf_target"
>_update_zebra_conf_target</a></h2>

<p>Add an installation target for updating Zebra&#39;s configuration files.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p>ExtUtils::MakeMaker(3)</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>MJ Ray mjr at phonecoop.coop Galen Charlton galen.charlton at liblime.com</p>
<p class="backlinkbottom"><b><a name="___bottom" href="index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
