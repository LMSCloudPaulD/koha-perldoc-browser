<html><head><title>advance_notices.pl</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Tue May 30 12:08:04 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#OPTIONS'>OPTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Configuration'>Configuration</a>
    <li class='indexItem indexItem2'><a href='#Outgoing_emails'>Outgoing emails</a>
    <li class='indexItem indexItem2'><a href='#Templates'>Templates</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#parse_letter'>parse_letter</a>
    <li class='indexItem indexItem2'><a href='#get_branch_info'>get_branch_info</a>
    <li class='indexItem indexItem2'><a href='#send_digests'>send_digests</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>advance_notices.pl - prepare messages to be sent to patrons for nearly due,
or due,
items</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>       advance_notices.pl
         [ -n ][ -m &#60;number of days&#62; ][ --itemscontent &#60;comma separated field list&#62; ][ -c ]</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This script prepares pre-due and item due reminders to be sent to patrons. It queues them in the message queue, which is processed by the process_message_queue.pl cronjob. The type and timing of the messages can be configured by the patrons in their &#34;My Alerts&#34; tab in the OPAC.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="--help"
><b>--help</b></a></dt>

<dd>
<p>Print a brief help message and exits.</p>

<dt><a name="--man"
><b>--man</b></a></dt>

<dd>
<p>Prints the manual page and exits.</p>

<dt><a name="-v"
><b>-v</b></a></dt>

<dd>
<p>Verbose. Without this flag set, only fatal errors are reported.</p>

<dt><a name="-n"
><b>-n</b></a></dt>

<dd>
<p>Do not send any email. Advanced or due notices that would have been sent to the patrons are printed to standard out.</p>

<dt><a name="-m"
><b>-m</b></a></dt>

<dd>
<p>Defines the maximum number of days in advance to send advance notices.</p>

<dt><a name="-c"
><b>-c</b></a></dt>

<dd>
<p>Confirm flag: Add this option. The script will only print a usage statement otherwise.</p>

<dt><a name="--itemscontent"
><b>--itemscontent</b></a></dt>

<dd>
<p>comma separated list of fields that get substituted into templates in places of the &#60;&#60;items.content&#62;&#62; placeholder. This defaults to date_due,title,author,barcode</p>

<p>Other possible values come from fields in the biblios, items and issues tables.</p>

<dt><a name="--digest-per-branch"
><b>--digest-per-branch</b></a></dt>

<dd>
<p>Flag to indicate that generation of message digests should be performed separately for each branch.</p>

<p>A patron could potentially have loans at several different branches There is no natural branch to set as the sender on the aggregated message in this situation so the default behavior is to use the borrowers home branch. This could surprise to the borrower when message sender is a library where they have not borrowed anything.</p>

<p>Enabling this flag ensures that the issuing library is the sender of the digested message. It has no effect unless the borrower has chosen &#39;Digests only&#39; on the advance messages.</p>

<dt><a name="--library"
><b>--library</b></a></dt>

<dd>
<p>select notices for one specific library. Use the value in the branches.branchcode table. This option can be repeated in order to select notices for a group of libraries.</p>

<dt><a name="--frombranch"
><b>--frombranch</b></a></dt>

<dd>
<p>Set the from address for the notice to one of &#39;item-homebranch&#39; or &#39;item-issuebranch&#39;.</p>

<p>Defaults to &#39;item-issuebranch&#39;</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Configuration"
>Configuration</a></h2>

<p>This script pays attention to the advanced notice configuration performed by borrowers in the OPAC, or by staff in the patron detail page of the intranet. The content of the messages is configured in Tools -&#62; Notices and slips. Advanced notices use the PREDUE template, due notices use DUE. More information about the use of this section of Koha is available in the Koha manual.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Outgoing_emails"
>Outgoing emails</a></h2>

<p>Typically, messages are prepared for each patron with due items, and who have selected (or the library has elected for them) Advance or Due notices.</p>

<p>These emails are staged in the outgoing message queue, as are messages produced by other features of Koha. This message queue must be processed regularly by the <em>misc/cronjobs/process_message_queue.pl</em> program.</p>

<p>In the event that the <code>-n</code> flag is passed to this program, no emails are sent. Instead, messages are sent on standard output from this program. They may be redirected to a file if desired.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Templates"
>Templates</a></h2>

<p>Templates can contain variables enclosed in double angle brackets like &#60;&#60;this&#62;&#62;. Those variables will be replaced with values specific to the overdue items or relevant patron. Available variables are:</p>

<dl>
<dt><a name="&#60;&#60;items.content&#62;&#62;"
>&#60;&#60;items.content&#62;&#62;</a></dt>

<dd>
<p>one line for each item, each line containing a tab separated list of date due, title, author, barcode</p>

<dt><a name="&#60;&#60;borrowers.*&#62;&#62;"
>&#60;&#60;borrowers.*&#62;&#62;</a></dt>

<dd>
<p>any field from the borrowers table</p>

<dt><a name="&#60;&#60;branches.*&#62;&#62;"
>&#60;&#60;branches.*&#62;&#62;</a></dt>

<dd>
<p>any field from the branches table</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p>The <em>misc/cronjobs/overdue_notices.pl</em> program allows you to send messages to patrons when their messages are overdue.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="parse_letter"
>parse_letter</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_branch_info"
>get_branch_info</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="send_digests"
>send_digests</a></h2>

<pre>    send_digests({
        digests =&#62; ...,
        sth =&#62; ...,
        letter_code =&#62; ...,
        get_item_info =&#62; ...,
    })</pre>

<p>Enqueue digested letters (or print them if -n was passed at command line).</p>

<p>Parameters:</p>

<dl>
<dt><a name="$digests"
><code>$digests</code></a></dt>

<dd>
<p>Reference to the array of digested messages.</p>

<dt><a name="$sth"
><code>$sth</code></a></dt>

<dd>
<p>Prepared statement handle for fetching overdue issues.</p>

<dt><a name="$letter_code"
><code>$letter_code</code></a></dt>

<dd>
<p>String that denote the letter code.</p>

<dt><a name="$get_item_info"
><code>$get_item_info</code></a></dt>

<dd>
<p>Subroutine for executing prepared statement. Takes parameters $sth, $borrowernumber and $borrower_parameters and return a generator function that produce the matching rows.</p>
</dd>
</dl>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
