<html><head><title>C4::ImportBatch</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Thu Mar 21 18:09:55 2024 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#GetZ3950BatchId'>GetZ3950BatchId</a>
    <li class='indexItem indexItem2'><a href='#GetWebserviceBatchId'>GetWebserviceBatchId</a>
    <li class='indexItem indexItem2'><a href='#GetImportRecordMarc'>GetImportRecordMarc</a>
    <li class='indexItem indexItem2'><a href='#AddImportBatch'>AddImportBatch</a>
    <li class='indexItem indexItem2'><a href='#GetImportBatch'>GetImportBatch</a>
    <li class='indexItem indexItem2'><a href='#AddBiblioToBatch'>AddBiblioToBatch</a>
    <li class='indexItem indexItem2'><a href='#AddAuthToBatch'>AddAuthToBatch</a>
    <li class='indexItem indexItem2'><a href='#BatchStageMarcRecords'>BatchStageMarcRecords</a>
    <li class='indexItem indexItem2'><a href='#AddItemsToImportBiblio'>AddItemsToImportBiblio</a>
    <li class='indexItem indexItem2'><a href='#BatchFindDuplicates'>BatchFindDuplicates</a>
    <li class='indexItem indexItem2'><a href='#BatchCommitRecords'>BatchCommitRecords</a>
    <li class='indexItem indexItem2'><a href='#_batchCommitItems'>_batchCommitItems</a>
    <li class='indexItem indexItem2'><a href='#BatchRevertRecords'>BatchRevertRecords</a>
    <li class='indexItem indexItem2'><a href='#BatchRevertItems'>BatchRevertItems</a>
    <li class='indexItem indexItem2'><a href='#CleanBatch'>CleanBatch</a>
    <li class='indexItem indexItem2'><a href='#DeleteBatch'>DeleteBatch</a>
    <li class='indexItem indexItem2'><a href='#GetAllImportBatches'>GetAllImportBatches</a>
    <li class='indexItem indexItem2'><a href='#GetStagedWebserviceBatches'>GetStagedWebserviceBatches</a>
    <li class='indexItem indexItem2'><a href='#GetImportBatchRangeDesc'>GetImportBatchRangeDesc</a>
    <li class='indexItem indexItem2'><a href='#GetItemNumbersFromImportBatch'>GetItemNumbersFromImportBatch</a>
    <li class='indexItem indexItem2'><a href='#GetNumberOfImportBatches'>GetNumberOfImportBatches</a>
    <li class='indexItem indexItem2'><a href='#GetImportBiblios'>GetImportBiblios</a>
    <li class='indexItem indexItem2'><a href='#GetImportRecordsRange'>GetImportRecordsRange</a>
    <li class='indexItem indexItem2'><a href='#GetBestRecordMatch'>GetBestRecordMatch</a>
    <li class='indexItem indexItem2'><a href='#GetImportBatchStatus'>GetImportBatchStatus</a>
    <li class='indexItem indexItem2'><a href='#SetImportBatchStatus'>SetImportBatchStatus</a>
    <li class='indexItem indexItem2'><a href='#SetMatchedBiblionumber'>SetMatchedBiblionumber</a>
    <li class='indexItem indexItem2'><a href='#GetImportBatchOverlayAction'>GetImportBatchOverlayAction</a>
    <li class='indexItem indexItem2'><a href='#SetImportBatchOverlayAction'>SetImportBatchOverlayAction</a>
    <li class='indexItem indexItem2'><a href='#GetImportBatchNoMatchAction'>GetImportBatchNoMatchAction</a>
    <li class='indexItem indexItem2'><a href='#SetImportBatchNoMatchAction'>SetImportBatchNoMatchAction</a>
    <li class='indexItem indexItem2'><a href='#GetImportBatchItemAction'>GetImportBatchItemAction</a>
    <li class='indexItem indexItem2'><a href='#SetImportBatchItemAction'>SetImportBatchItemAction</a>
    <li class='indexItem indexItem2'><a href='#GetImportBatchMatcher'>GetImportBatchMatcher</a>
    <li class='indexItem indexItem2'><a href='#SetImportBatchMatcher'>SetImportBatchMatcher</a>
    <li class='indexItem indexItem2'><a href='#GetImportRecordOverlayStatus'>GetImportRecordOverlayStatus</a>
    <li class='indexItem indexItem2'><a href='#SetImportRecordOverlayStatus'>SetImportRecordOverlayStatus</a>
    <li class='indexItem indexItem2'><a href='#GetImportRecordStatus'>GetImportRecordStatus</a>
    <li class='indexItem indexItem2'><a href='#SetImportRecordStatus'>SetImportRecordStatus</a>
    <li class='indexItem indexItem2'><a href='#GetImportRecordMatches'>GetImportRecordMatches</a>
    <li class='indexItem indexItem2'><a href='#SetImportRecordMatches'>SetImportRecordMatches</a>
    <li class='indexItem indexItem2'><a href='#RecordsFromISO2709File'>RecordsFromISO2709File</a>
    <li class='indexItem indexItem2'><a href='#RecordsFromMARCXMLFile'>RecordsFromMARCXMLFile</a>
    <li class='indexItem indexItem2'><a href='#RecordsFromMarcPlugin'>RecordsFromMarcPlugin</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>C4::ImportBatch - manage batches of imported MARC records</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>use C4::ImportBatch;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetZ3950BatchId"
>GetZ3950BatchId</a></h2>

<pre>  my $batchid = GetZ3950BatchId($z3950server);</pre>

<p>Retrieves the ID of the import batch for the Z39.50 reservoir for the given target. If necessary, creates the import batch.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetWebserviceBatchId"
>GetWebserviceBatchId</a></h2>

<pre>  my $batchid = GetWebserviceBatchId();</pre>

<p>Retrieves the ID of the import batch for webservice. If necessary, creates the import batch.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportRecordMarc"
>GetImportRecordMarc</a></h2>

<pre>  my ($marcblob, $encoding) = GetImportRecordMarc($import_record_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="AddImportBatch"
>AddImportBatch</a></h2>

<pre>  my $batch_id = AddImportBatch($params_hash);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportBatch"
>GetImportBatch</a></h2>

<pre>  my $row = GetImportBatch($batch_id);</pre>

<p>Retrieve a hashref of an import_batches row.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="AddBiblioToBatch"
>AddBiblioToBatch</a></h2>

<pre>  my $import_record_id = AddBiblioToBatch($batch_id, $record_sequence, 
                $marc_record, $encoding, $update_counts);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="AddAuthToBatch"
>AddAuthToBatch</a></h2>

<pre>  my $import_record_id = AddAuthToBatch($batch_id, $record_sequence,
                $marc_record, $encoding, $update_counts, [$marc_type]);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BatchStageMarcRecords"
>BatchStageMarcRecords</a></h2>

<p>( $batch_id, $num_records, $num_items, @invalid_records ) = BatchStageMarcRecords( $record_type, $encoding, $marc_records, $file_name, $marc_modification_template, $comments, $branch_code, $parse_items, $leave_as_staging, $progress_interval, $progress_callback );</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="AddItemsToImportBiblio"
>AddItemsToImportBiblio</a></h2>

<pre>  my @import_items_ids = AddItemsToImportBiblio($batch_id, 
                $import_record_id, $marc_record, $update_counts);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BatchFindDuplicates"
>BatchFindDuplicates</a></h2>

<pre>  my $num_with_matches = BatchFindDuplicates($batch_id, $matcher,
             $max_matches, $progress_interval, $progress_callback);</pre>

<p>Goes through the records loaded in the batch and attempts to find duplicates for each one. Sets the matching status of each record to &#34;no_match&#34; or &#34;auto_match&#34; as appropriate.</p>

<p>The $max_matches parameter is optional; if it is not supplied, it defaults to 10.</p>

<p>The $progress_interval and $progress_callback parameters are optional; if both are supplied, the sub referred to by $progress_callback will be invoked every $progress_interval records using the number of records processed as the singular argument.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BatchCommitRecords"
>BatchCommitRecords</a></h2>

<pre>  Takes a hashref containing params for committing the batch - optional parameters &#39;progress_interval&#39; and
  &#39;progress_callback&#39; will define code called every X records.

  my ($num_added, $num_updated, $num_items_added, $num_items_replaced, $num_items_errored, $num_ignored) =
        BatchCommitRecords({
            batch_id  =&#62; $batch_id,
            framework =&#62; $framework,
            overlay_framework =&#62; $overlay_framework,
            progress_interval =&#62; $progress_interval,
            progress_callback =&#62; $progress_callback,
        });</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_batchCommitItems"
>_batchCommitItems</a></h2>

<pre>  ($num_items_added, $num_items_errored) = 
         _batchCommitItems($import_record_id, $biblionumber, [$action, $biblioitemnumber]);</pre>

<p>Private function for batch committing item changes. We do not trigger a re-index here, that is left to the caller.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BatchRevertRecords"
>BatchRevertRecords</a></h2>

<pre>  my ($num_deleted, $num_errors, $num_reverted, $num_items_deleted, 
      $num_ignored) = BatchRevertRecords($batch_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BatchRevertItems"
>BatchRevertItems</a></h2>

<pre>  my $num_items_deleted = BatchRevertItems($import_record_id, $biblionumber);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CleanBatch"
>CleanBatch</a></h2>

<pre>  CleanBatch($batch_id)</pre>

<p>Deletes all staged records from the import batch and sets the status of the batch to &#39;cleaned&#39;. Note that deleting a stage record does *not* affect any record that has been committed to the database.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="DeleteBatch"
>DeleteBatch</a></h2>

<pre>  DeleteBatch($batch_id)</pre>

<p>Deletes the record from the database. This can only be done once the batch has been cleaned.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetAllImportBatches"
>GetAllImportBatches</a></h2>

<pre>  my $results = GetAllImportBatches();</pre>

<p>Returns a references to an array of hash references corresponding to all import_batches rows (of batch_type &#39;batch&#39;), sorted in ascending order by import_batch_id.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetStagedWebserviceBatches"
>GetStagedWebserviceBatches</a></h2>

<pre>  my $batch_ids = GetStagedWebserviceBatches();</pre>

<p>Returns a references to an array of batch id&#39;s of batch_type &#39;webservice&#39; that are not imported</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportBatchRangeDesc"
>GetImportBatchRangeDesc</a></h2>

<pre>  my $results = GetImportBatchRangeDesc($offset, $results_per_group);</pre>

<p>Returns a reference to an array of hash references corresponding to import_batches rows (sorted in descending order by import_batch_id) start at the given offset.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetItemNumbersFromImportBatch"
>GetItemNumbersFromImportBatch</a></h2>

<pre>  my @itemsnos = GetItemNumbersFromImportBatch($batch_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetNumberOfImportBatches"
>GetNumberOfImportBatches</a></h2>

<pre>  my $count = GetNumberOfImportBatches();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportBiblios"
>GetImportBiblios</a></h2>

<pre>  my $results = GetImportBiblios($importid);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportRecordsRange"
>GetImportRecordsRange</a></h2>

<pre>  my $results = GetImportRecordsRange($batch_id, $offset, $results_per_group);</pre>

<p>Returns a reference to an array of hash references corresponding to import_biblios/import_auths/import_records rows for a given batch starting at the given offset.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetBestRecordMatch"
>GetBestRecordMatch</a></h2>

<pre>  my $record_id = GetBestRecordMatch($import_record_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportBatchStatus"
>GetImportBatchStatus</a></h2>

<pre>  my $status = GetImportBatchStatus($batch_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetImportBatchStatus"
>SetImportBatchStatus</a></h2>

<pre>  SetImportBatchStatus($batch_id, $new_status);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetMatchedBiblionumber"
>SetMatchedBiblionumber</a></h2>

<pre>  SetMatchedBiblionumber($import_record_id, $biblionumber);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportBatchOverlayAction"
>GetImportBatchOverlayAction</a></h2>

<pre>  my $overlay_action = GetImportBatchOverlayAction($batch_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetImportBatchOverlayAction"
>SetImportBatchOverlayAction</a></h2>

<pre>  SetImportBatchOverlayAction($batch_id, $new_overlay_action);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportBatchNoMatchAction"
>GetImportBatchNoMatchAction</a></h2>

<pre>  my $nomatch_action = GetImportBatchNoMatchAction($batch_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetImportBatchNoMatchAction"
>SetImportBatchNoMatchAction</a></h2>

<pre>  SetImportBatchNoMatchAction($batch_id, $new_nomatch_action);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportBatchItemAction"
>GetImportBatchItemAction</a></h2>

<pre>  my $item_action = GetImportBatchItemAction($batch_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetImportBatchItemAction"
>SetImportBatchItemAction</a></h2>

<pre>  SetImportBatchItemAction($batch_id, $new_item_action);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportBatchMatcher"
>GetImportBatchMatcher</a></h2>

<pre>  my $matcher_id = GetImportBatchMatcher($batch_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetImportBatchMatcher"
>SetImportBatchMatcher</a></h2>

<pre>  SetImportBatchMatcher($batch_id, $new_matcher_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportRecordOverlayStatus"
>GetImportRecordOverlayStatus</a></h2>

<pre>  my $overlay_status = GetImportRecordOverlayStatus($import_record_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetImportRecordOverlayStatus"
>SetImportRecordOverlayStatus</a></h2>

<pre>  SetImportRecordOverlayStatus($import_record_id, $new_overlay_status);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportRecordStatus"
>GetImportRecordStatus</a></h2>

<pre>  my $status = GetImportRecordStatus($import_record_id);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetImportRecordStatus"
>SetImportRecordStatus</a></h2>

<pre>  SetImportRecordStatus($import_record_id, $new_status);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetImportRecordMatches"
>GetImportRecordMatches</a></h2>

<pre>  my $results = GetImportRecordMatches($import_record_id, $best_only);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetImportRecordMatches"
>SetImportRecordMatches</a></h2>

<pre>  SetImportRecordMatches($import_record_id, @matches);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="RecordsFromISO2709File"
>RecordsFromISO2709File</a></h2>

<pre>    my ($errors, $records) = C4::ImportBatch::RecordsFromISO2709File($input_file, $record_type, $encoding);</pre>

<p>Reads ISO2709 binary porridge from the given file and creates MARC::Record-objects out of it.</p>

<p>@PARAM1, String, absolute path to the ISO2709 file. @PARAM2, String, see stage_file.pl @PARAM3, String, should be utf8</p>

<p>Returns two array refs.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="RecordsFromMARCXMLFile"
>RecordsFromMARCXMLFile</a></h2>

<pre>    my ($errors, $records) = C4::ImportBatch::RecordsFromMARCXMLFile($input_file, $encoding);</pre>

<p>Creates MARC::Record-objects out of the given MARCXML-file.</p>

<p>@PARAM1, String, absolute path to the MARCXML file. @PARAM2, String, should be utf8</p>

<p>Returns two array refs.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="RecordsFromMarcPlugin"
>RecordsFromMarcPlugin</a></h2>

<pre>    Converts text of input_file into array of MARC records with to_marc plugin</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Koha Development Team &#60;http://koha-community.org/&#62;</p>

<p>Galen Charlton &#60;galen.charlton@liblime.com&#62;</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
