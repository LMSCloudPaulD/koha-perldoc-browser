<html><head><title>C4::OAI::Sets</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Fri Dec 29 00:20:12 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#GetOAISets'>GetOAISets</a>
    <li class='indexItem indexItem2'><a href='#GetOAISet'>GetOAISet</a>
    <li class='indexItem indexItem2'><a href='#GetOAISetBySpec'>GetOAISetBySpec</a>
    <li class='indexItem indexItem2'><a href='#ModOAISet'>ModOAISet</a>
    <li class='indexItem indexItem2'><a href='#DelOAISet'>DelOAISet</a>
    <li class='indexItem indexItem2'><a href='#AddOAISet'>AddOAISet</a>
    <li class='indexItem indexItem2'><a href='#GetOAISetsMappings'>GetOAISetsMappings</a>
    <li class='indexItem indexItem2'><a href='#GetOAISetMappings'>GetOAISetMappings</a>
    <li class='indexItem indexItem2'><a href='#ModOAISetMappings_%7B'>ModOAISetMappings {</a>
    <li class='indexItem indexItem2'><a href='#GetOAISetsBiblio'>GetOAISetsBiblio</a>
    <li class='indexItem indexItem2'><a href='#DelOAISetsBiblio'>DelOAISetsBiblio</a>
    <li class='indexItem indexItem2'><a href='#CalcOAISetsBiblio'>CalcOAISetsBiblio</a>
    <li class='indexItem indexItem2'><a href='#ModOAISetsBiblios'>ModOAISetsBiblios</a>
    <li class='indexItem indexItem2'><a href='#UpdateOAISetsBiblio'>UpdateOAISetsBiblio</a>
    <li class='indexItem indexItem2'><a href='#AddOAISetsBiblios'>AddOAISetsBiblios</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>C4::OAI::Sets - OAI Sets management functions</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>C4::OAI::Sets contains functions for managing storage and editing of OAI Sets.</p>

<p>OAI Set description can be found <a href="http://www.openarchives.org/OAI/openarchivesprotocol.html#Set" class="podlinkurl"
>here</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetOAISets"
>GetOAISets</a></h2>

<pre>    $oai_sets = GetOAISets;</pre>

<p>GetOAISets return a array reference of hash references describing the sets. The hash references looks like this:</p>

<pre>    {
        &#39;name&#39;         =&#62; &#39;set name&#39;,
        &#39;spec&#39;         =&#62; &#39;set spec&#39;,
        &#39;descriptions&#39; =&#62; [
            &#39;description 1&#39;,
            &#39;description 2&#39;,
            ...
        ]
    }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetOAISet"
>GetOAISet</a></h2>

<pre>    $set = GetOAISet($set_id);</pre>

<p>GetOAISet returns a hash reference describing the set with the given set_id.</p>

<p>See GetOAISets to see what the hash looks like.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetOAISetBySpec"
>GetOAISetBySpec</a></h2>

<pre>    my $set = GetOAISetBySpec($setSpec);</pre>

<p>Returns a hash describing the set whose spec is $setSpec</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ModOAISet"
>ModOAISet</a></h2>

<pre>    my $set = {
        &#39;id&#39; =&#62; $set_id,                 # mandatory
        &#39;spec&#39; =&#62; $spec,                 # mandatory
        &#39;name&#39; =&#62; $name,                 # mandatory
        &#39;descriptions =&#62; \@descriptions, # optional, [] to remove descriptions
    };
    ModOAISet($set);</pre>

<p>ModOAISet modify a set in the database.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="DelOAISet"
>DelOAISet</a></h2>

<pre>    DelOAISet($set_id);</pre>

<p>DelOAISet remove the set with the given set_id</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="AddOAISet"
>AddOAISet</a></h2>

<pre>    my $set = {
        &#39;id&#39; =&#62; $set_id,                 # mandatory
        &#39;spec&#39; =&#62; $spec,                 # mandatory
        &#39;name&#39; =&#62; $name,                 # mandatory
        &#39;descriptions =&#62; \@descriptions, # optional
    };
    my $set_id = AddOAISet($set);</pre>

<p>AddOAISet adds a new set and returns its id, or undef if something went wrong.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetOAISetsMappings"
>GetOAISetsMappings</a></h2>

<pre>    my $mappings = GetOAISetsMappings;</pre>

<p>GetOAISetsMappings returns mappings for all OAI Sets.</p>

<p>Mappings define how biblios are categorized in sets. A mapping is defined by six properties:</p>

<pre>    {
        marcfield =&#62; &#39;XXX&#39;,              # the MARC field to check
        marcsubfield =&#62; &#39;Y&#39;,             # the MARC subfield to check
        operator =&#62; &#39;A&#39;,                 # the operator &#39;equal&#39; or &#39;notequal&#39;; &#39;equal&#39; if &#39;&#39;
        marcvalue =&#62; &#39;zzzz&#39;,             # the value to check
        rule_operator =&#62; &#39;and|or|undef&#39;, # the operator between the rules
        rule_order    =&#62; &#39;n&#39;             # the order of the rule for the mapping
    }</pre>

<p>If defined in a set mapping, a biblio which have at least one &#39;Y&#39; subfield of one &#39;XXX&#39; field equal to &#39;zzzz&#39; will belong to this set.</p>

<p>GetOAISetsMappings returns a hashref of arrayrefs of hashrefs. The first hashref keys are the sets IDs, so it looks like this:</p>

<pre>    $mappings = {
        &#39;1&#39; =&#62; [
            {
                marcfield =&#62; &#39;XXX&#39;,
                marcsubfield =&#62; &#39;Y&#39;,
                operator =&#62; &#39;A&#39;,
                marcvalue =&#62; &#39;zzzz&#39;,
                rule_operator =&#62; &#39;and|or|undef&#39;,
                rule_order =&#62; &#39;n&#39;
            },
            {
                ...
            },
            ...
        ],
        &#39;2&#39; =&#62; [...],
        ...
    };</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetOAISetMappings"
>GetOAISetMappings</a></h2>

<pre>    my $set_mappings = GetOAISetMappings($set_id);</pre>

<p>Return mappings for the set with given set_id. It&#39;s an arrayref of hashrefs</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ModOAISetMappings_{"
>ModOAISetMappings {</a></h2>

<pre>    my $mappings = [
        {
            marcfield =&#62; &#39;XXX&#39;,
            marcsubfield =&#62; &#39;Y&#39;,
            operator =&#62; &#39;A&#39;,
            marcvalue =&#62; &#39;zzzz&#39;
        },
        ...
    ];
    ModOAISetMappings($set_id, $mappings);</pre>

<p>ModOAISetMappings modifies mappings of a given set.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetOAISetsBiblio"
>GetOAISetsBiblio</a></h2>

<pre>    $oai_sets = GetOAISetsBiblio($biblionumber);</pre>

<p>Return the OAI sets where biblio appears.</p>

<p>Return value is an arrayref of hashref where each element of the array is a set. Keys of hash are id, spec and name</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="DelOAISetsBiblio"
>DelOAISetsBiblio</a></h2>

<pre>    DelOAISetsBiblio($biblionumber);</pre>

<p>Remove a biblio from all sets</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CalcOAISetsBiblio"
>CalcOAISetsBiblio</a></h2>

<pre>    my @sets = CalcOAISetsBiblio($record, $oai_sets_mappings);</pre>

<p>Return a list of set ids the record belongs to. $record must be a MARC::Record and $oai_sets_mappings (optional) must be a hashref returned by GetOAISetsMappings</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ModOAISetsBiblios"
>ModOAISetsBiblios</a></h2>

<pre>    my $oai_sets_biblios = {
        &#39;1&#39; =&#62; [1, 3, 4],   # key is the set_id, and value is an array ref of biblionumbers
        &#39;2&#39; =&#62; [],
        ...
    };
    ModOAISetsBiblios($oai_sets_biblios);</pre>

<p>ModOAISetsBiblios deletes all records from oai_sets_biblios table and calls AddOAISetsBiblios. This table is then used in opac/oai.pl.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="UpdateOAISetsBiblio"
>UpdateOAISetsBiblio</a></h2>

<pre>    UpdateOAISetsBiblio($biblionumber, $record);</pre>

<p>Update OAI sets for one biblio. The two parameters are mandatory. $record is a MARC::Record.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="AddOAISetsBiblios"
>AddOAISetsBiblios</a></h2>

<pre>    my $oai_sets_biblios = {
        &#39;1&#39; =&#62; [1, 3, 4],   # key is the set_id, and value is an array ref of biblionumbers
        &#39;2&#39; =&#62; [],
        ...
    };
    ModOAISetsBiblios($oai_sets_biblios);</pre>

<p>AddOAISetsBiblios insert given infos in oai_sets_biblios table. This table is then used in opac/oai.pl.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
