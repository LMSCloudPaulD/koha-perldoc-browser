<html><head><title>Koha::Calendar</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Fri Feb 17 12:29:20 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new_%3A_Create_a_calendar_object'>new : Create a calendar object</a>
    <li class='indexItem indexItem2'><a href='#addDuration'>addDuration</a>
    <li class='indexItem indexItem2'><a href='#addHours'>addHours</a>
    <li class='indexItem indexItem2'><a href='#get_push_amt'>get_push_amt</a>
    <li class='indexItem indexItem2'><a href='#addDays'>addDays</a>
    <li class='indexItem indexItem2'><a href='#is_holiday'>is_holiday</a>
    <li class='indexItem indexItem2'><a href='#days_between'>days_between</a>
    <li class='indexItem indexItem2'><a href='#hours_between'>hours_between</a>
    <li class='indexItem indexItem2'><a href='#next_open_days'>next_open_days</a>
    <li class='indexItem indexItem2'><a href='#prev_open_days'>prev_open_days</a>
    <li class='indexItem indexItem2'><a href='#days_forward'>days_forward</a>
    <li class='indexItem indexItem2'><a href='#set_daysmode'>set_daysmode</a>
    <li class='indexItem indexItem2'><a href='#clear_weekly_closed_days'>clear_weekly_closed_days</a>
    <li class='indexItem indexItem2'><a href='#add_holiday'>add_holiday</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#DIAGNOSTICS'>DIAGNOSTICS</a>
  <li class='indexItem indexItem1'><a href='#BUGS_AND_LIMITATIONS'>BUGS AND LIMITATIONS</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#LICENSE_AND_COPYRIGHT'>LICENSE AND COPYRIGHT</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Koha::Calendar - Object containing a branches calendar</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use Koha::Calendar

  my $c = Koha::Calendar-&#62;new( branchcode =&#62; &#39;MAIN&#39; );
  my $dt = dt_from_string();

  # are we open
  $open = $c-&#62;is_holiday($dt);
  # when will item be due if loan period = $dur (a DateTime::Duration object)
  $duedate = $c-&#62;addDuration($dt,$dur,&#39;days&#39;);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<pre>  Implements those features of C4::Calendar needed for Staffs Rolling Loans</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new_:_Create_a_calendar_object"
>new : Create a calendar object</a></h2>

<p>my $calendar = Koha::Calendar-&#62;new( branchcode =&#62; &#39;MAIN&#39; );</p>

<p>The option branchcode is required</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="addDuration"
>addDuration</a></h2>

<pre>    my $dt = $calendar-&#62;addDuration($date, $dur, $unit)</pre>

<p><code>$date</code> is a DateTime object representing the starting date of the interval.</p>

<p><code>$offset</code> is a DateTime::Duration to add to it</p>

<p><code>$unit</code> is a string value &#39;days&#39; or &#39;hours&#39; toflag granularity of duration</p>

<p>Currently unit is only used to invoke Staffs return Monday at 10 am rule this parameter will be removed when issuingrules properly cope with that</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="addHours"
>addHours</a></h2>

<pre>    my $dt = $calendar-&#62;addHours($date, $dur, $return_by_hour )</pre>

<p><code>$date</code> is a DateTime object representing the starting date of the interval.</p>

<p><code>$offset</code> is a DateTime::Duration to add to it</p>

<p><code>$return_by_hour</code> is an integer value representing the opening hour for the branch</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_push_amt"
>get_push_amt</a></h2>

<pre>    my $amt = $calendar-&#62;get_push_amt($date)</pre>

<p><code>$date</code> is a DateTime object representing a closed return date</p>

<p>Using the days_mode syspref value and the nature of the closed return date, return how many days we should jump forward to find another return date</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="addDays"
>addDays</a></h2>

<pre>    my $dt = $calendar-&#62;addDays($date, $dur)</pre>

<p><code>$date</code> is a DateTime object representing the starting date of the interval.</p>

<p><code>$offset</code> is a DateTime::Duration to add to it</p>

<p><code>$unit</code> is a string value &#39;days&#39; or &#39;hours&#39; toflag granularity of duration</p>

<p>Currently unit is only used to invoke Staffs return Monday at 10 am rule this parameter will be removed when issuingrules properly cope with that</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_holiday"
>is_holiday</a></h2>

<p>$yesno = $calendar-&#62;is_holiday($dt);</p>

<p>passed a DateTime object returns 1 if it is a closed day 0 if not according to the calendar</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="days_between"
>days_between</a></h2>

<p>$duration = $calendar-&#62;days_between($start_dt, $end_dt);</p>

<p>Passed two dates returns a DateTime::Duration object measuring the length between them ignoring closed days. Always returns a positive number irrespective of the relative order of the parameters.</p>

<p>Note: This routine assumes neither the passed start_dt nor end_dt can be a closed day</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="hours_between"
>hours_between</a></h2>

<p>$duration = $calendar-&#62;hours_between($start_dt, $end_dt);</p>

<p>Passed two dates returns a DateTime::Duration object measuring the length between them ignoring closed days. Always returns a positive number irrespective of the relative order of the parameters.</p>

<p>Note: This routine assumes neither the passed start_dt nor end_dt can be a closed day</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="next_open_days"
>next_open_days</a></h2>

<p>$datetime = $calendar-&#62;next_open_days($duedate_dt, $to_add)</p>

<p>Passed a Datetime and number of days, returns another Datetime representing the next open day after adding the passed number of days. It is intended for use to calculate the due date when useDaysMode syspref is set to either &#39;Datedue&#39;, &#39;Calendar&#39; or &#39;Dayweek&#39;.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="prev_open_days"
>prev_open_days</a></h2>

<p>$datetime = $calendar-&#62;prev_open_days($duedate_dt, $to_sub)</p>

<p>Passed a Datetime and a number of days, returns another Datetime representing the previous open day after subtracting the number of passed days. It is intended for use to calculate the due date when useDaysMode syspref is set to either &#39;Datedue&#39;, &#39;Calendar&#39; or &#39;Dayweek&#39;.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="days_forward"
>days_forward</a></h2>

<p>$datetime = $calendar-&#62;days_forward($start_dt, $to_add)</p>

<p>Passed a Datetime and number of days, returns another Datetime representing the next open day after adding the passed number of days. It is intended for use to calculate the due date when useDaysMode syspref is set to either &#39;Datedue&#39;, &#39;Calendar&#39; or &#39;Dayweek&#39;.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_daysmode"
>set_daysmode</a></h2>

<p>For testing only allows the calling script to change days mode</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="clear_weekly_closed_days"
>clear_weekly_closed_days</a></h2>

<p>In test mode changes the testing set of closed days to a new set with no closed days. TODO passing an array of closed days to this would allow testing of more configurations</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_holiday"
>add_holiday</a></h2>

<p>Passed a datetime object this will add it to the calendar&#39;s list of closed days. This is for testing so that we can alter the Calenfar object&#39;s list of specified dates</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DIAGNOSTICS"
>DIAGNOSTICS</a></h1>

<p>Will croak if not passed a branchcode in new</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS_AND_LIMITATIONS"
>BUGS AND LIMITATIONS</a></h1>

<p>This only contains a limited subset of the functionality in C4::Calendar Only enough to support Staffs Rolling loans</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Colin Campbell colin.campbell@ptfs-europe.com</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE_AND_COPYRIGHT"
>LICENSE AND COPYRIGHT</a></h1>

<p>Copyright (c) 2011 PTFS-Europe Ltd All rights reserved</p>

<p>Koha is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.</p>

<p>Koha is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License along with Koha; if not, see &#60;http://www.gnu.org/licenses&#62;.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
