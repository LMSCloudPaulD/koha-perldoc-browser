<html><head><title>search</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Sun Sep 24 00:22:14 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#OVERVIEW'>OVERVIEW</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#INTRO'>INTRO</a>
    <li class='indexItem indexItem2'><a href='#LOADING_ADVANCED_SEARCH_PAGE'>LOADING ADVANCED SEARCH PAGE</a>
    <li class='indexItem indexItem2'><a href='#PERFORMING_A_SEARCH'>PERFORMING A SEARCH</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#1._Building_Query_Strings'>1. Building Query Strings</a>
      <li class='indexItem indexItem3'><a href='#2._Perform_the_Search'>2. Perform the Search</a>
      <li class='indexItem indexItem3'><a href='#3._Build_HTML'>3. Build HTML</a>
      <li class='indexItem indexItem3'><a href='#Additional_Notes'>Additional Notes</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#prepare_adv_search_types'>prepare_adv_search_types</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>search - a search script for finding records in a Koha system (Version 3)</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OVERVIEW"
>OVERVIEW</a></h1>

<p>This script utilizes a new search API for Koha 3.
It is designed to be simple to use and configure,
yet capable of performing feats like stemming,
field weighting,
relevance ranking,
support for multiple query language formats (CCL,
CQL,
PQF),
full support for the bib1 attribute set,
extended attribute sets defined in Zebra profiles,
access to the full range of Z39.50 and SRU query options,
federated searches on Z39.50/SRU targets,
etc.</p>

<p>The API as represented in this script is mostly sound,
even if the individual functions in Search.pm and Koha.pm need to be cleaned up.
Of course,
you are free to disagree :-)</p>

<p>I will attempt to describe what is happening at each part of this script.
-- Joshua Ferraro &#60;jmf AT liblime DOT com&#62;</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="INTRO"
>INTRO</a></h2>

<p>This script performs two functions:</p>

<dl>
<dt><a name="1._interacts_with_Koha_to_retrieve_and_display_the_results_of_a_search"
>1.
interacts with Koha to retrieve and display the results of a search</a></dt>

<dd>
<dt><a name="2._loads_the_advanced_search_page"
>2.
loads the advanced search page</a></dt>
</dl>

<p>These two functions share many of the same variables and modules,
so the first task is to load what they have in common and determine which template to use.
Once determined,
proceed to only load the variables and procedures necessary for that function.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="LOADING_ADVANCED_SEARCH_PAGE"
>LOADING ADVANCED SEARCH PAGE</a></h2>

<p>This is fairly straightforward,
and I won&#39;t go into detail ;-)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="PERFORMING_A_SEARCH"
>PERFORMING A SEARCH</a></h2>

<p>If we&#39;re performing a search,
this script performs three primary operations:</p>

<dl>
<dt><a name="1._builds_query_strings_(yes,_plural)"
>1.
builds query strings (yes,
plural)</a></dt>

<dd>
<dt><a name="2._perform_the_search_and_return_the_results_array"
>2.
perform the search and return the results array</a></dt>

<dd>
<dt><a name="3._build_the_HTML_for_output_to_the_template"
>3.
build the HTML for output to the template</a></dt>
</dl>

<p>There are several additional secondary functions performed that I will not cover in detail.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="1._Building_Query_Strings"
>1.
Building Query Strings</a></h3>

<p>There are several types of queries needed in the process of search and retrieve:</p>

<dl>
<dt><a name="1_$query_-_the_fully-built_query_passed_to_zebra"
>1 $query - the fully-built query passed to zebra</a></dt>

<dd>
<p>This is the most complex query that needs to be built.
The original design goal was to use a custom CCL2PQF query parser to translate an incoming CCL query into a multi-leaf query to pass to Zebra.
It needs to be multi-leaf to allow field weighting,
koha-specific relevance ranking,
and stemming.
When I have a chance I&#39;ll try to flesh out this section to better explain.</p>

<p>This query incorporates query profiles that aren&#39;t compatible with most non-Zebra Z39.50 targets to accomplish the field weighting and relevance ranking.</p>

<dt><a 
>2 $simple_query - a simple query that doesn&#39;t contain the field weighting,
stemming,
etc.,
suitable to pass off to other search targets</a></dt>

<dd>
<p>This query is just the user&#39;s query expressed in CCL CQL,
or PQF for passing to a non-zebra Z39.50 target (one that doesn&#39;t support the extended profile that Zebra does).</p>

<dt><a name="3_$query_cgi_-_passed_to_the_template_/_saved_for_future_refinements_of_the_query_(by_user)"
>3 $query_cgi - passed to the template / saved for future refinements of the query (by user)</a></dt>

<dd>
<p>This is a simple string that completely expresses the query as a CGI string that can be used for future refinements of the query or as a part of a history feature.</p>

<dt><a name="4_$query_desc_-_Human_search_description_-_what_the_user_sees_in_search_feedback_area"
>4 $query_desc - Human search description - what the user sees in search feedback area</a></dt>

<dd>
<p>This is a simple string that is human readable.
It will contain &#39;=&#39;,
&#39;,&#39;,
etc.</p>
</dd>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="2._Perform_the_Search"
>2.
Perform the Search</a></h3>

<p>This section takes the query strings and performs searches on the named servers,
including the Koha Zebra server,
stores the results in a deeply nested object,
builds &#39;faceted results&#39;,
and returns these objects.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="3._Build_HTML"
>3.
Build HTML</a></h3>

<p>The final major section of this script takes the objects collected thusfar and builds the HTML for output to the template and user.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Additional_Notes"
>Additional Notes</a></h3>

<p>Not yet completed...</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="prepare_adv_search_types"
>prepare_adv_search_types</a></h2>

<pre>    my $type = C4::Context-&#62;preference(&#34;AdvancedSearchTypes&#34;) || &#34;itemtypes&#34;;
    my @advanced_search_types = prepare_adv_search_types($type);</pre>

<p>Different types can be searched for in the advanced search. This takes the system preference that defines these types and parses it into an arrayref for the template.</p>

<p>&#34;itemtypes&#34; is handled specially, as itemtypes aren&#39;t an authorised value. It also accounts for the &#34;item-level_itypes&#34; system preference.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
