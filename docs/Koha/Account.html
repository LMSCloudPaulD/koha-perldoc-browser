<html><head><title>Koha::Accounts</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Mon Dec  2 12:08:45 2024 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#pay'>pay</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#add_credit'>add_credit</a>
      <li class='indexItem indexItem3'><a href='#payin_amount'>payin_amount</a>
      <li class='indexItem indexItem3'><a href='#add_debit'>add_debit</a>
      <li class='indexItem indexItem3'><a href='#payout_amount'>payout_amount</a>
      <li class='indexItem indexItem3'><a href='#balance'>balance</a>
      <li class='indexItem indexItem3'><a href='#outstanding_debits'>outstanding_debits</a>
      <li class='indexItem indexItem3'><a href='#outstanding_credits'>outstanding_credits</a>
      <li class='indexItem indexItem3'><a href='#non_issues_charges'>non_issues_charges</a>
      <li class='indexItem indexItem3'><a href='#lines'>lines</a>
      <li class='indexItem indexItem3'><a href='#credits'>credits</a>
      <li class='indexItem indexItem3'><a href='#debits'>debits</a>
      <li class='indexItem indexItem3'><a href='#reconcile_balance'>reconcile_balance</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Koha::Accounts - Module for managing payments and fees for patrons</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="pay"
>pay</a></h2>

<p>This method allows payments to be made against fees/fines</p>

<p>Koha::Account-&#62;new( { patron_id =&#62; $borrowernumber } )-&#62;pay( { amount =&#62; $amount,
note =&#62; $note,
description =&#62; $description,
library_id =&#62; $branchcode,
lines =&#62; $lines,
# Arrayref of Koha::Account::Line objects to pay credit_type =&#62; $type,
# credit_type_code code item_id =&#62; $itemnumber,
# pass the itemnumber if this is a credit pertianing to a specific item (i.e LOST_FOUND) } );</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="add_credit"
>add_credit</a></h3>

<p>This method allows adding credits to a patron&#39;s account</p>

<p>my $credit_line = Koha::Account-&#62;new({ patron_id =&#62; $patron_id })-&#62;add_credit( { amount =&#62; $amount,
description =&#62; $description,
interface =&#62; $interface,
issue_id =&#62; $checkout-&#62;id,
item_id =&#62; $item_id,
library_id =&#62; $library_id,
note =&#62; $note,
payment_type =&#62; $payment_type,
type =&#62; $credit_type,
user_id =&#62; $user_id,
} );</p>

<p>$credit_type can be any of: - &#39;CREDIT&#39; - &#39;PAYMENT&#39; - &#39;FORGIVEN&#39; - &#39;LOST_FOUND&#39; - &#39;OVERPAYMENT&#39; - &#39;PAYMENT&#39; - &#39;WRITEOFF&#39; - &#39;PROCESSING_FOUND&#39;</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="payin_amount"
>payin_amount</a></h3>

<pre>    my $credit = $account-&#62;payin_amount(
        {
            amount          =&#62; $amount,
            type            =&#62; $credit_type,
            payment_type    =&#62; $payment_type,
            cash_register   =&#62; $register_id,
            interface       =&#62; $interface,
            library_id      =&#62; $branchcode,
            user_id         =&#62; $staff_id,
            debits          =&#62; $debit_lines,
            description     =&#62; $description,
            note            =&#62; $note
        }
    );</pre>

<p>This method allows an amount to be paid into a patrons account and immediately applied against debts.</p>

<p>You can optionally pass a debts parameter which consists of an arrayref of Koha::Account::Line debit lines.</p>

<p>$credit_type can be any of: - &#39;PAYMENT&#39; - &#39;WRITEOFF&#39; - &#39;FORGIVEN&#39;</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="add_debit"
>add_debit</a></h3>

<p>This method allows adding debits to a patron&#39;s account</p>

<pre>    my $debit_line = Koha::Account-&#62;new({ patron_id =&#62; $patron_id })-&#62;add_debit(
        {
            amount           =&#62; $amount,
            description      =&#62; $description,
            note             =&#62; $note,
            user_id          =&#62; $user_id,
            interface        =&#62; $interface,
            library_id       =&#62; $library_id,
            type             =&#62; $debit_type,
            transaction_type =&#62; $transaction_type,
            cash_register    =&#62; $register_id,
            item_id          =&#62; $item_id,
            issue_id         =&#62; $issue_id
        }
    );</pre>

<p>$debit_type can be any of: - ACCOUNT - ACCOUNT_RENEW - RESERVE_EXPIRED - LOST - sundry - NEW_CARD - OVERDUE - PROCESSING - RENT - RENT_DAILY - RENT_RENEW - RENT_DAILY_RENEW - RESERVE - PAYOUT</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="payout_amount"
>payout_amount</a></h3>

<pre>    my $debit = $account-&#62;payout_amount(
        {
            payout_type =&#62; $payout_type,
            register_id =&#62; $register_id,
            staff_id    =&#62; $staff_id,
            interface   =&#62; &#39;intranet&#39;,
            amount      =&#62; $amount,
            credits     =&#62; $credit_lines
        }
    );</pre>

<p>This method allows an amount to be paid out from a patrons account against outstanding credits.</p>

<p>$payout_type can be any of the defined payment_types:</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="balance"
>balance</a></h3>

<p>my $balance = $self-&#62;balance</p>

<p>Return the balance (sum of amountoutstanding columns)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="outstanding_debits"
>outstanding_debits</a></h3>

<p>my $lines = Koha::Account-&#62;new({ patron_id =&#62; $patron_id })-&#62;outstanding_debits;</p>

<p>It returns the debit lines with outstanding amounts for the patron.</p>

<p>It returns a Koha::Account::Lines iterator.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="outstanding_credits"
>outstanding_credits</a></h3>

<p>my $lines = Koha::Account-&#62;new({ patron_id =&#62; $patron_id })-&#62;outstanding_credits;</p>

<p>It returns the credit lines with outstanding amounts for the patron.</p>

<p>It returns a Koha::Account::Lines iterator.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="non_issues_charges"
>non_issues_charges</a></h3>

<p>my $non_issues_charges = $self-&#62;non_issues_charges</p>

<p>Calculates amount immediately owing by the patron - non-issue charges.</p>

<p>Charges can be set as exempt from non-issue by editing the debit type in the Debit Types area of System Preferences.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="lines"
>lines</a></h3>

<p>my $lines = $self-&#62;lines;</p>

<p>Return all credits and debits for the user, outstanding or otherwise</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="credits"
>credits</a></h3>

<pre>  my $credits = $self-&#62;credits;</pre>

<p>Return all credits for the user</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="debits"
>debits</a></h3>

<pre>  my $debits = $self-&#62;debits;</pre>

<p>Return all debits for the user</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="reconcile_balance"
>reconcile_balance</a></h3>

<p>$account-&#62;reconcile_balance();</p>

<p>Find outstanding credits and use them to pay outstanding debits. Currently, this implicitly uses the &#39;First In First Out&#39; rule for applying credits against debits.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Kyle M Hall &#60;kyle.m.hall@gmail.com&#62; Tom&#225;s Cohen Arazi &#60;tomascohen@gmail.com&#62; Martin Renvoize &#60;martin.renvoize@ptfs-europe.com&#62;</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
