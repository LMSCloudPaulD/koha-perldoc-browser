<html><head><title>C4::Members::Messaging</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Fri Jul  7 18:14:15 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#GetMessagingPreferences'>GetMessagingPreferences</a>
    <li class='indexItem indexItem2'><a href='#SetMessagingPreference'>SetMessagingPreference</a>
    <li class='indexItem indexItem2'><a href='#GetMessagingOptions'>GetMessagingOptions</a>
    <li class='indexItem indexItem2'><a href='#SetMessagingPreferencesFromDefaults'>SetMessagingPreferencesFromDefaults</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#TABLES'>TABLES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#message_queue'>message_queue</a>
    <li class='indexItem indexItem2'><a href='#message_attributes'>message_attributes</a>
    <li class='indexItem indexItem2'><a href='#message_transport_types'>message_transport_types</a>
    <li class='indexItem indexItem2'><a href='#message_transports'>message_transports</a>
    <li class='indexItem indexItem2'><a href='#borrower_message_preferences'>borrower_message_preferences</a>
    <li class='indexItem indexItem2'><a href='#borrower_message_transport_preferences'>borrower_message_transport_preferences</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#CONFIG'>CONFIG</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Adding_a_New_Kind_of_Message_to_the_System'>Adding a New Kind of Message to the System</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>C4::Members::Messaging - manage patron messaging preferences</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use C4::Members::Messaging</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module lets you modify a patron&#39;s messaging preferences.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetMessagingPreferences"
>GetMessagingPreferences</a></h2>

<pre>  my $preferences = C4::Members::Messaging::GetMessagingPreferences( { borrowernumber =&#62; $borrower-&#62;{&#39;borrowernumber&#39;},
                                                                       message_name   =&#62; &#39;Item_Due &#39; } );

  my $preferences = C4::Members::Messaging::GetMessagingPreferences( { categorycode =&#62; &#39;LIBRARY&#39;,
                                                                       message_name   =&#62; &#39;Item_Due &#39; } );</pre>

<p>returns: a hashref of messaging preferences for a borrower or patron category for a particlar message_name</p>

<p>Requires either a borrowernumber or a categorycode key, but not both.</p>

<p>message_name argument is a message attribute name.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetMessagingPreference"
>SetMessagingPreference</a></h2>

<p>This method defines how a user (or a default for a patron category) wants to get a certain message delivered. The list of valid message types can be delivered can be found in the <code>message_attributes</code> table, and the list of valid message transports can be found in the <code>message_transport_types</code> table.</p>

<pre>  C4::Members::Messaging::SetMessagingPreference( { borrowernumber          =&#62; $borrower-&#62;{&#39;borrowernumber&#39;}
                                                    message_attribute_id    =&#62; $message_attribute_id,
                                                    message_transport_types =&#62; [ qw( email sms ) ],
                                                    days_in_advance         =&#62; 5
                                                    wants_digest            =&#62; 1 } )</pre>

<p>returns nothing useful.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetMessagingOptions"
>GetMessagingOptions</a></h2>

<pre>  my $messaging_options = C4::Members::Messaging::GetMessagingOptions()</pre>

<p>returns a hashref of messaging options available.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SetMessagingPreferencesFromDefaults"
>SetMessagingPreferencesFromDefaults</a></h2>

<pre>  C4::Members::Messaging::SetMessagingPreferencesFromDefaults( { borrowernumber =&#62; $borrower-&#62;{&#39;borrowernumber&#39;}
                                                                categorycode   =&#62; &#39;CPL&#39; } );</pre>

<p>Given a borrowernumber and a patron category code (from the <code>borrowernumber</code> and <code>categorycode</code> keys in the parameter hashref), replace all of the patron&#39;s current messaging preferences with whatever defaults are defined for the patron category.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TABLES"
>TABLES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="message_queue"
>message_queue</a></h2>

<p>The actual messages which will be sent via a cron job running <em>misc/cronjobs/process_message_queue.pl</em>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="message_attributes"
>message_attributes</a></h2>

<p>What kinds of messages can be sent?</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="message_transport_types"
>message_transport_types</a></h2>

<p>What transports can messages be sent vith? (email, sms, etc.)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="message_transports"
>message_transports</a></h2>

<p>How are message_attributes and message_transport_types correlated?</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="borrower_message_preferences"
>borrower_message_preferences</a></h2>

<p>What messages do the borrowers want to receive?</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="borrower_message_transport_preferences"
>borrower_message_transport_preferences</a></h2>

<p>What transport should a message be sent with?</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIG"
>CONFIG</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Adding_a_New_Kind_of_Message_to_the_System"
>Adding a New Kind of Message to the System</a></h2>

<ol>
<li>Add a new template to the `letter` table.</li>

<li>Insert a row into the `message_attributes` table.</li>

<li>Insert rows into `message_transports` for each message_transport_type.</li>
</ol>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../C4/Letters.html" class="podlinkpod"
>C4::Letters</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Koha Development Team &#60;http://koha-community.org/&#62;</p>

<p>Andrew Moore &#60;andrew.moore@liblime.com&#62;</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
