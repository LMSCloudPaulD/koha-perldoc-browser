<html><head><title>ImportKBARTFile</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Wed Feb 19 12:08:27 2025 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#API'>API</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Class_methods'>Class methods</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#job_type'>job_type</a>
      <li class='indexItem indexItem3'><a href='#process'>process</a>
      <li class='indexItem indexItem3'><a href='#enqueue'>enqueue</a>
      <li class='indexItem indexItem3'><a href='#format_title'>format_title</a>
      <li class='indexItem indexItem3'><a href='#read_file'>read_file</a>
      <li class='indexItem indexItem3'><a href='#create_title_hash_from_line_data'>create_title_hash_from_line_data</a>
      <li class='indexItem indexItem3'><a href='#check_for_matching_title'>check_for_matching_title</a>
      <li class='indexItem indexItem3'><a href='#create_linked_resource'>create_linked_resource</a>
      <li class='indexItem indexItem3'><a href='#get_first_and_last_issue_dates'>get_first_and_last_issue_dates</a>
      <li class='indexItem indexItem3'><a href='#get_valid_headers'>get_valid_headers</a>
      <li class='indexItem indexItem3'><a href='#calculate_chunked_params_size'>calculate_chunked_params_size</a>
      <li class='indexItem indexItem3'><a href='#is_file_too_large'>is_file_too_large</a>
      <li class='indexItem indexItem3'><a href='#rescue_EBSCO_files'>rescue_EBSCO_files</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ImportKBARTFile - Create new eHoldings titles from a KBART file</p>

<p>This is a subclass of Koha::BackgroundJob.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="API"
>API</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Class_methods"
>Class methods</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="job_type"
>job_type</a></h3>

<p>Define the job type of this job.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="process"
>process</a></h3>

<p>Process the import.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="enqueue"
>enqueue</a></h3>

<p>Enqueue the new job</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="format_title"
>format_title</a></h3>

<p>Formats a title to fit the names of the database fields in Koha</p>

<p>Kbart field &#34;title_id&#34; = &#34;external_id&#34; in Koha Kbart field &#34;coverage_notes&#34; = &#34;notes&#34; in Koha</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="read_file"
>read_file</a></h3>

<p>Reads a file to provide report headers and lines to be processed</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="create_title_hash_from_line_data"
>create_title_hash_from_line_data</a></h3>

<p>Takes a line and creates a hash of the values mapped to the column headings Only accepts fields that are in the list of permitted KBART fields,
other fields are ignored (This is identified to the user on the background job status page)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="check_for_matching_title"
>check_for_matching_title</a></h3>

<p>Checks whether this title already exists to avoid duplicates</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="create_linked_resource"
>create_linked_resource</a></h3>

<p>Creates a resource for a newly stored title.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_first_and_last_issue_dates"
>get_first_and_last_issue_dates</a></h3>

<p>Gets and formats a date for storing on the resource.
Dates can come from files in YYYY,
YYYY-MM or YYYY-MM-DD format</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_valid_headers"
>get_valid_headers</a></h3>

<p>Returns a list of permitted headers in a KBART phase II file</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="calculate_chunked_params_size"
>calculate_chunked_params_size</a></h3>

<p>Calculates average line size to work out how many lines to chunk a large file into Uses only 75% of the max_allowed_packet as an upper limit</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_file_too_large"
>is_file_too_large</a></h3>

<p>Calculates the final size of the background job object that will need storing to check if we exceed the max_allowed_packet</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="rescue_EBSCO_files"
>rescue_EBSCO_files</a></h3>

<p>EBSCO have an incorrect spelling for &#34;preceding_publication_title_id&#34; in all of their KBART files (preceding is spelled with a double &#39;e&#39;).
This means all of their KBART files fail to import using the current methodology.
There is no simple way of finding out who the vendor is before importing so all KBART files from any vendor are going to have to be checked for this spelling and corrected.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
