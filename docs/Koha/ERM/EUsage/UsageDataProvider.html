<html><head><title>Koha::ERM::EUsage::UsageDataProvider</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../../../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Tue Dec 26 18:12:07 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#API'>API</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Class_Methods'>Class Methods</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#counter_files'>counter_files</a>
      <li class='indexItem indexItem3'><a href='#enqueue_counter_file_processing_job'>enqueue_counter_file_processing_job</a>
      <li class='indexItem indexItem3'><a href='#enqueue_sushi_harvest_jobs'>enqueue_sushi_harvest_jobs</a>
      <li class='indexItem indexItem3'><a href='#harvest_sushi'>harvest_sushi</a>
      <li class='indexItem indexItem3'><a href='#set_background_job_callbacks'>set_background_job_callbacks</a>
      <li class='indexItem indexItem3'><a href='#test_connection'>test_connection</a>
      <li class='indexItem indexItem3'><a href='#erm_usage_titles'>erm_usage_titles</a>
      <li class='indexItem indexItem3'><a href='#erm_usage_muses'>erm_usage_muses</a>
      <li class='indexItem indexItem3'><a href='#erm_usage_platforms'>erm_usage_platforms</a>
      <li class='indexItem indexItem3'><a href='#erm_usage_items'>erm_usage_items</a>
      <li class='indexItem indexItem3'><a href='#erm_usage_databases'>erm_usage_databases</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Internal_methods'>Internal methods</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#_build_url_query'>_build_url_query</a>
      <li class='indexItem indexItem3'><a href='#_validate_url'>_validate_url</a>
      <li class='indexItem indexItem3'><a href='#_check_trailing_character'>_check_trailing_character</a>
      <li class='indexItem indexItem3'><a href='#_sushi_errors'>_sushi_errors</a>
      <li class='indexItem indexItem3'><a href='#_counter_file_size_too_large'>_counter_file_size_too_large</a>
      <li class='indexItem indexItem3'><a href='#_type'>_type</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Koha::ERM::EUsage::UsageDataProvider - Koha ErmUsageDataProvider Object class</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="API"
>API</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Class_Methods"
>Class Methods</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="counter_files"
>counter_files</a></h3>

<p>Getter/setter for counter_files for this usage data provider</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="enqueue_counter_file_processing_job"
>enqueue_counter_file_processing_job</a></h3>

<p>Enqueues a background job to process a COUNTER file that has been uploaded</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="enqueue_sushi_harvest_jobs"
>enqueue_sushi_harvest_jobs</a></h3>

<p>Enqueues one harvest background job for each report type in this usage data provider</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="harvest_sushi"
>harvest_sushi</a></h3>

<pre>    $ud_provider-&#62;harvest_sushi(
        {
            begin_date  =&#62; $args-&#62;{begin_date},
            end_date    =&#62; $args-&#62;{end_date},
            report_type =&#62; $args-&#62;{report_type}
        }
    );</pre>

<p>Runs this usage data provider&#39;s SUSHI harvester Builds the URL query and requests the COUNTER 5 SUSHI service</p>

<p>COUNTER SUSHI api spec: https://app.swaggerhub.com/apis/COUNTER/counter-sushi_5_0_api/5.0.2</p>

<dl>
<dt><a name="begin_date"
>begin_date</a></dt>

<dd>
<p>Begin date of the SUSHI harvest</p>
</dd>
</dl>

<dl>
<dt><a name="end_date"
>end_date</a></dt>

<dd>
<p>End date of the SUSHI harvest</p>
</dd>
</dl>

<dl>
<dt><a name="report_type"
>report_type</a></dt>

<dd>
<p>Report type to run this harvest on</p>
</dd>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="set_background_job_callbacks"
>set_background_job_callbacks</a></h3>

<pre>    $self-&#62;set_background_job_callbacks($background_job_callbacks);</pre>

<p>Sets the background job callbacks</p>

<dl>
<dt><a name="background_job_callbacks"
>background_job_callbacks</a></dt>

<dd>
<p>Background job callbacks</p>
</dd>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="test_connection"
>test_connection</a></h3>

<p>Tests the connection of the harvester to the SUSHI service and returns any alerts of planned SUSHI outages</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="erm_usage_titles"
>erm_usage_titles</a></h3>

<p>Method to embed erm_usage_titles to titles for report formatting</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="erm_usage_muses"
>erm_usage_muses</a></h3>

<p>Method to embed erm_usage_muses to titles for report formatting</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="erm_usage_platforms"
>erm_usage_platforms</a></h3>

<p>Method to embed erm_usage_platforms to platforms for report formatting</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="erm_usage_items"
>erm_usage_items</a></h3>

<p>Method to embed erm_usage_items to items for report formatting</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="erm_usage_databases"
>erm_usage_databases</a></h3>

<p>Method to embed erm_usage_databases to databases for report formatting</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Internal_methods"
>Internal methods</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="_build_url_query"
>_build_url_query</a></h3>

<p>Build the URL query params for COUNTER 5 SUSHI request</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="_validate_url"
>_validate_url</a></h3>

<p>Checks whether the url ends in a trailing &#34;/&#34; and adds one if not</p>

<p>my $url = _validate_url($url, &#39;harvest&#39;)</p>

<p>$caller is either the harvest_sushi function (&#34;harvest&#34;) or the test_connection function (&#34;status&#34;)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="_check_trailing_character"
>_check_trailing_character</a></h3>

<p>Checks whether a url string ends in a &#34;/&#34; before we concatenate further params to the end of the url</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="_sushi_errors"
>_sushi_errors</a></h3>

<p>Checks and handles possible errors in the SUSHI response Additionally, adds background job report message(s) if that is the case</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="_counter_file_size_too_large"
>_counter_file_size_too_large</a></h3>

<p>Checks whether a counter file size exceeds the size allowed by the database or not Additionally, adds a background job report message if that is the case</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="_type"
>_type</a></h3>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
