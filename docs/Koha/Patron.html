<html><head><title>Koha::Patron</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Tue Jun  6 12:06:45 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#API'>API</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Class_Methods'>Class Methods</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#new'>new</a>
      <li class='indexItem indexItem3'><a href='#fixup_cardnumber'>fixup_cardnumber</a>
      <li class='indexItem indexItem3'><a href='#trim_whitespace'>trim_whitespace</a>
      <li class='indexItem indexItem3'><a href='#plain_text_password'>plain_text_password</a>
      <li class='indexItem indexItem3'><a href='#store'>store</a>
      <li class='indexItem indexItem3'><a href='#delete'>delete</a>
      <li class='indexItem indexItem3'><a href='#category'>category</a>
      <li class='indexItem indexItem3'><a href='#image'>image</a>
      <li class='indexItem indexItem3'><a href='#library'>library</a>
      <li class='indexItem indexItem3'><a href='#sms_provider'>sms_provider</a>
      <li class='indexItem indexItem3'><a href='#guarantor_relationships'>guarantor_relationships</a>
      <li class='indexItem indexItem3'><a href='#guarantee_relationships'>guarantee_relationships</a>
      <li class='indexItem indexItem3'><a href='#relationships_debt'>relationships_debt</a>
      <li class='indexItem indexItem3'><a href='#housebound_profile'>housebound_profile</a>
      <li class='indexItem indexItem3'><a href='#housebound_role'>housebound_role</a>
      <li class='indexItem indexItem3'><a href='#siblings'>siblings</a>
      <li class='indexItem indexItem3'><a href='#merge_with'>merge_with</a>
      <li class='indexItem indexItem3'><a href='#wants_check_for_previous_checkout'>wants_check_for_previous_checkout</a>
      <li class='indexItem indexItem3'><a href='#do_check_for_previous_checkout'>do_check_for_previous_checkout</a>
      <li class='indexItem indexItem3'><a href='#is_debarred'>is_debarred</a>
      <li class='indexItem indexItem3'><a href='#is_expired'>is_expired</a>
      <li class='indexItem indexItem3'><a href='#password_expired'>password_expired</a>
      <li class='indexItem indexItem3'><a href='#is_going_to_expire'>is_going_to_expire</a>
      <li class='indexItem indexItem3'><a href='#set_password'>set_password</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Exceptions'>Exceptions</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#renew_account'>renew_account</a>
      <li class='indexItem indexItem3'><a href='#has_overdues'>has_overdues</a>
      <li class='indexItem indexItem3'><a href='#track_login'>track_login</a>
      <li class='indexItem indexItem3'><a href='#move_to_deleted'>move_to_deleted</a>
      <li class='indexItem indexItem3'><a href='#can_request_article'>can_request_article</a>
      <li class='indexItem indexItem3'><a href='#article_request_fee'>article_request_fee</a>
      <li class='indexItem indexItem3'><a href='#add_article_request_fee_if_needed'>add_article_request_fee_if_needed</a>
      <li class='indexItem indexItem3'><a href='#article_requests'>article_requests</a>
      <li class='indexItem indexItem3'><a href='#add_enrolment_fee_if_needed'>add_enrolment_fee_if_needed</a>
      <li class='indexItem indexItem3'><a href='#checkouts'>checkouts</a>
      <li class='indexItem indexItem3'><a href='#pending_checkouts'>pending_checkouts</a>
      <li class='indexItem indexItem3'><a href='#old_checkouts'>old_checkouts</a>
      <li class='indexItem indexItem3'><a href='#overdues'>overdues</a>
      <li class='indexItem indexItem3'><a href='#restrictions'>restrictions</a>
      <li class='indexItem indexItem3'><a href='#get_routing_lists'>get_routing_lists</a>
      <li class='indexItem indexItem3'><a href='#get_age'>get_age</a>
      <li class='indexItem indexItem3'><a href='#is_valid_age'>is_valid_age</a>
      <li class='indexItem indexItem3'><a href='#account'>account</a>
      <li class='indexItem indexItem3'><a href='#holds'>holds</a>
      <li class='indexItem indexItem3'><a href='#old_holds'>old_holds</a>
      <li class='indexItem indexItem3'><a href='#curbside_pickups'>curbside_pickups</a>
      <li class='indexItem indexItem3'><a href='#return_claims'>return_claims</a>
      <li class='indexItem indexItem3'><a href='#notice_email_address'>notice_email_address</a>
      <li class='indexItem indexItem3'><a href='#first_valid_email_address'>first_valid_email_address</a>
      <li class='indexItem indexItem3'><a href='#get_club_enrollments'>get_club_enrollments</a>
      <li class='indexItem indexItem3'><a href='#get_enrollable_clubs'>get_enrollable_clubs</a>
      <li class='indexItem indexItem3'><a href='#account_locked'>account_locked</a>
      <li class='indexItem indexItem3'><a href='#can_see_patron_infos'>can_see_patron_infos</a>
      <li class='indexItem indexItem3'><a href='#can_see_patrons_from'>can_see_patrons_from</a>
      <li class='indexItem indexItem3'><a href='#can_edit_items_from'>can_edit_items_from</a>
      <li class='indexItem indexItem3'><a href='#libraries_where_can_edit_items'>libraries_where_can_edit_items</a>
      <li class='indexItem indexItem3'><a href='#libraries_where_can_see_patrons'>libraries_where_can_see_patrons</a>
      <li class='indexItem indexItem3'><a href='#can_see_things_from'>can_see_things_from</a>
      <li class='indexItem indexItem3'><a href='#can_log_into'>can_log_into</a>
      <li class='indexItem indexItem3'><a href='#libraries_where_can_see_things'>libraries_where_can_see_things</a>
      <li class='indexItem indexItem3'><a href='#has_permission'>has_permission</a>
      <li class='indexItem indexItem3'><a href='#is_superlibrarian'>is_superlibrarian</a>
      <li class='indexItem indexItem3'><a href='#is_adult'>is_adult</a>
      <li class='indexItem indexItem3'><a href='#is_child'>is_child</a>
      <li class='indexItem indexItem3'><a href='#has_valid_userid'>has_valid_userid</a>
      <li class='indexItem indexItem3'><a href='#generate_userid'>generate_userid</a>
      <li class='indexItem indexItem3'><a href='#add_extended_attribute'>add_extended_attribute</a>
      <li class='indexItem indexItem3'><a href='#extended_attributes'>extended_attributes</a>
      <li class='indexItem indexItem3'><a href='#messages'>messages</a>
      <li class='indexItem indexItem3'><a href='#lock'>lock</a>
      <li class='indexItem indexItem3'><a href='#anonymize'>anonymize</a>
      <li class='indexItem indexItem3'><a href='#add_guarantor'>add_guarantor</a>
      <li class='indexItem indexItem3'><a href='#get_extended_attribute'>get_extended_attribute</a>
      <li class='indexItem indexItem3'><a href='#to_api'>to_api</a>
      <li class='indexItem indexItem3'><a href='#to_api_mapping'>to_api_mapping</a>
      <li class='indexItem indexItem3'><a href='#queue_notice'>queue_notice</a>
      <li class='indexItem indexItem3'><a href='#safe_to_delete'>safe_to_delete</a>
      <li class='indexItem indexItem3'><a href='#recalls'>recalls</a>
      <li class='indexItem indexItem3'><a href='#account_balance'>account_balance</a>
      <li class='indexItem indexItem3'><a href='#notify_library_of_registration'>notify_library_of_registration</a>
      <li class='indexItem indexItem3'><a href='#has_messaging_preference'>has_messaging_preference</a>
      <li class='indexItem indexItem3'><a href='#can_patron_change_staff_only_lists'>can_patron_change_staff_only_lists</a>
      <li class='indexItem indexItem3'><a href='#can_patron_change_permitted_staff_lists'>can_patron_change_permitted_staff_lists</a>
      <li class='indexItem indexItem3'><a href='#encode_secret'>encode_secret</a>
      <li class='indexItem indexItem3'><a href='#decoded_secret'>decoded_secret</a>
      <li class='indexItem indexItem3'><a href='#virtualshelves'>virtualshelves</a>
      <li class='indexItem indexItem3'><a href='#get_savings'>get_savings</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Internal_methods'>Internal methods</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#_type'>_type</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Koha::Patron - Koha Patron Object class</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="API"
>API</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Class_Methods"
>Class Methods</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="new"
>new</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="fixup_cardnumber"
>fixup_cardnumber</a></h3>

<p>Autogenerate next cardnumber from highest value found in database</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="trim_whitespace"
>trim_whitespace</a></h3>

<p>trim whitespace from data which has some non-whitespace in it.
Could be moved to Koha::Object if need to be reused</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="plain_text_password"
>plain_text_password</a></h3>

<p>$patron-&#62;plain_text_password( $password );</p>

<p>stores a copy of the unencrypted password in the object for use in code before encrypting for db</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="store"
>store</a></h3>

<p>Patron specific store method to cleanup record and do other necessary things before saving to db</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="delete"
>delete</a></h3>

<p>$patron-&#62;delete</p>

<p>Delete patron&#39;s holds,
lists and finally the patron.</p>

<p>Lists owned by the borrower are deleted or ownership is transferred depending on the ListOwnershipUponPatronDeletion pref,
but entries from the borrower to other lists are kept.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="category"
>category</a></h3>

<p>my $patron_category = $patron-&#62;category</p>

<p>Return the patron category for this patron</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="image"
>image</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="library"
>library</a></h3>

<p>Returns a Koha::Library object representing the patron&#39;s home library.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="sms_provider"
>sms_provider</a></h3>

<p>Returns a Koha::SMS::Provider object representing the patron&#39;s SMS provider.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="guarantor_relationships"
>guarantor_relationships</a></h3>

<p>Returns Koha::Patron::Relationships object for this patron&#39;s guarantors</p>

<p>Returns the set of relationships for the patrons that are guarantors for this patron.</p>

<p>Note that a guarantor should exist as a patron in Koha; it was not possible to add them without a guarantor_id in the interface for some time.
Bug 30472 restricts it on db level.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="guarantee_relationships"
>guarantee_relationships</a></h3>

<p>Returns Koha::Patron::Relationships object for this patron&#39;s guarantors</p>

<p>Returns the set of relationships for the patrons that are guarantees for this patron.</p>

<p>The method returns Koha::Patron::Relationship objects for the sake of consistency with the guantors method.
A guarantee by definition must exist as a patron in Koha.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="relationships_debt"
>relationships_debt</a></h3>

<p>Returns the amount owed by the patron&#39;s guarantors *and* the other guarantees of those guarantors</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="housebound_profile"
>housebound_profile</a></h3>

<p>Returns the HouseboundProfile associated with this patron.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="housebound_role"
>housebound_role</a></h3>

<p>Returns the HouseboundRole associated with this patron.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="siblings"
>siblings</a></h3>

<p>Returns the siblings of this patron.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="merge_with"
>merge_with</a></h3>

<pre>    my $patron = Koha::Patrons-&#62;find($id);
    $patron-&#62;merge_with( \@patron_ids );

    This subroutine merges a list of patrons into the patron record. This is accomplished by finding
    all related patron ids for the patrons to be merged in other tables and changing the ids to be that
    of the keeper patron.</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="wants_check_for_previous_checkout"
>wants_check_for_previous_checkout</a></h3>

<pre>    $wants_check = $patron-&#62;wants_check_for_previous_checkout;</pre>

<p>Return 1 if Koha needs to perform PrevIssue checking, else 0.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="do_check_for_previous_checkout"
>do_check_for_previous_checkout</a></h3>

<pre>    $do_check = $patron-&#62;do_check_for_previous_checkout($item);</pre>

<p>Return 1 if the bib associated with $ITEM has previously been checked out to $PATRON, 0 otherwise.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_debarred"
>is_debarred</a></h3>

<p>my $debarment_expiration = $patron-&#62;is_debarred;</p>

<p>Returns the date a patron debarment will expire, or undef if the patron is not debarred</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_expired"
>is_expired</a></h3>

<p>my $is_expired = $patron-&#62;is_expired;</p>

<p>Returns 1 if the patron is expired or 0;</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="password_expired"
>password_expired</a></h3>

<p>my $password_expired = $patron-&#62;password_expired;</p>

<p>Returns 1 if the patron&#39;s password is expired or 0;</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_going_to_expire"
>is_going_to_expire</a></h3>

<p>my $is_going_to_expire = $patron-&#62;is_going_to_expire;</p>

<p>Returns 1 if the patron is going to expired, depending on the NotifyBorrowerDeparture pref or 0</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="set_password"
>set_password</a></h3>

<pre>    $patron-&#62;set_password({ password =&#62; $plain_text_password [, skip_validation =&#62; 1 ] });</pre>

<p>Set the patron&#39;s password.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Exceptions"
>Exceptions</a></h4>

<p>The passed string is validated against the current password enforcement policy. Validation can be skipped by passing the <i>skip_validation</i> parameter.</p>

<p>Exceptions are thrown if the password is not good enough.</p>

<dl>
<dt><a name="Koha::Exceptions::Password::TooShort"
>Koha::Exceptions::Password::TooShort</a></dt>

<dd>
<dt><a name="Koha::Exceptions::Password::WhitespaceCharacters"
>Koha::Exceptions::Password::WhitespaceCharacters</a></dt>

<dd>
<dt><a name="Koha::Exceptions::Password::TooWeak"
>Koha::Exceptions::Password::TooWeak</a></dt>

<dd>
<dt><a name="Koha::Exceptions::Password::Plugin_(if_a_&#34;check_password&#34;_plugin_is_enabled)"
>Koha::Exceptions::Password::Plugin (if a &#34;check password&#34; plugin is enabled)</a></dt>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="renew_account"
>renew_account</a></h3>

<p>my $new_expiry_date = $patron-&#62;renew_account</p>

<p>Extending the subscription to the expiry date.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="has_overdues"
>has_overdues</a></h3>

<p>my $has_overdues = $patron-&#62;has_overdues;</p>

<p>Returns the number of patron&#39;s overdues</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="track_login"
>track_login</a></h3>

<pre>    $patron-&#62;track_login;
    $patron-&#62;track_login({ force =&#62; 1 });

    Tracks a (successful) login attempt.
    The preference TrackLastPatronActivity must be enabled. Or you
    should pass the force parameter.</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="move_to_deleted"
>move_to_deleted</a></h3>

<p>my $is_moved = $patron-&#62;move_to_deleted;</p>

<p>Move a patron to the deletedborrowers table. This can be done before deleting a patron, to make sure the data are not completely deleted.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="can_request_article"
>can_request_article</a></h3>

<pre>    if ( $patron-&#62;can_request_article( $library-&#62;id ) ) { ... }</pre>

<p>Returns true if the patron can request articles. As limits apply for the patron on the same day, those completed the same day are considered as current.</p>

<p>A <i>library_id</i> can be passed as parameter, falling back to userenv if absent.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="article_request_fee"
>article_request_fee</a></h3>

<pre>    my $fee = $patron-&#62;article_request_fee(
        {
          [ library_id =&#62; $library-&#62;id, ]
        }
    );</pre>

<p>Returns the fee to be charged to the patron when it places an article request.</p>

<p>A <i>library_id</i> can be passed as parameter, falling back to userenv if absent.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="add_article_request_fee_if_needed"
>add_article_request_fee_if_needed</a></h3>

<pre>    my $fee = $patron-&#62;add_article_request_fee_if_needed(
        {
          [ item_id    =&#62; $item-&#62;id,
            library_id =&#62; $library-&#62;id, ]
        }
    );</pre>

<p>If an article request fee needs to be charged, it adds a debit to the patron&#39;s account.</p>

<p>Returns the fee line.</p>

<p>A <i>library_id</i> can be passed as parameter, falling back to userenv if absent.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="article_requests"
>article_requests</a></h3>

<pre>    my $article_requests = $patron-&#62;article_requests;</pre>

<p>Returns the patron article requests.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="add_enrolment_fee_if_needed"
>add_enrolment_fee_if_needed</a></h3>

<p>my $enrolment_fee = $patron-&#62;add_enrolment_fee_if_needed($renewal);</p>

<p>Add enrolment fee for a patron if needed.</p>

<p>$renewal - boolean denoting whether this is an account renewal or not</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="checkouts"
>checkouts</a></h3>

<p>my $checkouts = $patron-&#62;checkouts</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="pending_checkouts"
>pending_checkouts</a></h3>

<p>my $pending_checkouts = $patron-&#62;pending_checkouts</p>

<p>This method will return the same as $self-&#62;checkouts, but with a prefetch on items, biblio and biblioitems.</p>

<p>It has been introduced to replaced the C4::Members::GetPendingIssues subroutine</p>

<p>It should not be used directly, prefer to access fields you need instead of retrieving all these fields in one go.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="old_checkouts"
>old_checkouts</a></h3>

<p>my $old_checkouts = $patron-&#62;old_checkouts</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="overdues"
>overdues</a></h3>

<p>my $overdue_items = $patron-&#62;overdues</p>

<p>Return the overdue items</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="restrictions"
>restrictions</a></h3>

<pre>  my $restrictions = $patron-&#62;restrictions;</pre>

<p>Returns the patron restrictions.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_routing_lists"
>get_routing_lists</a></h3>

<p>my $routinglists = $patron-&#62;get_routing_lists</p>

<p>Returns the routing lists a patron is subscribed to.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_age"
>get_age</a></h3>

<pre>    my $age = $patron-&#62;get_age</pre>

<p>Return the age of the patron</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_valid_age"
>is_valid_age</a></h3>

<p>my $is_valid = $patron-&#62;is_valid_age</p>

<p>Return 1 if patron&#39;s age is between allowed limits, returns 0 if it&#39;s not.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="account"
>account</a></h3>

<p>my $account = $patron-&#62;account</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="holds"
>holds</a></h3>

<p>my $holds = $patron-&#62;holds</p>

<p>Return all the holds placed by this patron</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="old_holds"
>old_holds</a></h3>

<p>my $old_holds = $patron-&#62;old_holds</p>

<p>Return all the historical holds for this patron</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="curbside_pickups"
>curbside_pickups</a></h3>

<p>my $curbside_pickups = $patron-&#62;curbside_pickups;</p>

<p>Return all the curbside pickups for this patron</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="return_claims"
>return_claims</a></h3>

<p>my $return_claims = $patron-&#62;return_claims</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="notice_email_address"
>notice_email_address</a></h3>

<pre>  my $email = $patron-&#62;notice_email_address;</pre>

<p>Return the email address of patron used for notices. Returns the empty string if no email address.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="first_valid_email_address"
>first_valid_email_address</a></h3>

<p>my $first_valid_email_address = $patron-&#62;first_valid_email_address</p>

<p>Return the first valid email address for a patron. For now, the order is defined as email, emailpro, B_email. Returns the empty string if the borrower has no email addresses.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_club_enrollments"
>get_club_enrollments</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_enrollable_clubs"
>get_enrollable_clubs</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="account_locked"
>account_locked</a></h3>

<p>my $is_locked = $patron-&#62;account_locked</p>

<p>Return true if the patron has reached the maximum number of login attempts (see pref FailedLoginAttempts). If login_attempts is &#60; 0, this is interpreted as an administrative lockout (independent of FailedLoginAttempts; see also Koha::Patron-&#62;lock). Otherwise return false. If the pref is not set (empty string, null or 0), the feature is considered as disabled.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="can_see_patron_infos"
>can_see_patron_infos</a></h3>

<p>my $can_see = $patron-&#62;can_see_patron_infos( $patron );</p>

<p>Return true if the patron (usually the logged in user) can see the patron&#39;s infos for a given patron</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="can_see_patrons_from"
>can_see_patrons_from</a></h3>

<p>my $can_see = $patron-&#62;can_see_patrons_from( $branchcode );</p>

<p>Return true if the patron (usually the logged in user) can see the patron&#39;s infos from a given library</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="can_edit_items_from"
>can_edit_items_from</a></h3>

<pre>    my $can_edit = $patron-&#62;can_edit_items_from( $branchcode );</pre>

<p>Return true if the <i>Koha::Patron</i> can edit items from the given branchcode</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="libraries_where_can_edit_items"
>libraries_where_can_edit_items</a></h3>

<pre>    my $libraries = $patron-&#62;libraries_where_can_edit_items;</pre>

<p>Return the list of branchcodes(!) of libraries the patron is allowed to items for. The branchcodes are arbitrarily returned sorted. We are supposing here that the object is related to the logged in patron (use of C4::Context::only_my_library)</p>

<p>An empty array means no restriction, the user can edit any item.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="libraries_where_can_see_patrons"
>libraries_where_can_see_patrons</a></h3>

<p>my $libraries = $patron-&#62;libraries_where_can_see_patrons;</p>

<p>Return the list of branchcodes(!) of libraries the patron is allowed to see other patron&#39;s infos. The branchcodes are arbitrarily returned sorted. We are supposing here that the object is related to the logged in patron (use of C4::Context::only_my_library)</p>

<p>An empty array means no restriction, the patron can see patron&#39;s infos from any libraries.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="can_see_things_from"
>can_see_things_from</a></h3>

<p>my $can_see = $patron-&#62;can_see_things_from( $branchcode );</p>

<p>Return true if the <i>Koha::Patron</i> can perform some action on the given thing</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="can_log_into"
>can_log_into</a></h3>

<p>my $can_log_into = $patron-&#62;can_log_into( $library );</p>

<p>Given a <i>Koha::Library</i> object, it returns a boolean representing the fact the patron can log into a the library.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="libraries_where_can_see_things"
>libraries_where_can_see_things</a></h3>

<pre>    my $libraries = $patron-&#62;libraries_where_can_see_things;</pre>

<p>Returns a list of libraries where an aribitarary action is allowed to be taken by the logged in librarian against an object based on some branchcode related to the object ( patron branchcode, item homebranch, etc ).</p>

<p>We are supposing here that the object is related to the logged in librarian (use of C4::Context::only_my_library)</p>

<p>An empty array means no restriction, the thing can see thing&#39;s infos from any libraries.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="has_permission"
>has_permission</a></h3>

<p>my $permission = $patron-&#62;has_permission($required);</p>

<p>See C4::Auth::haspermission for details of syntax for $required</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_superlibrarian"
>is_superlibrarian</a></h3>

<pre>  my $is_superlibrarian = $patron-&#62;is_superlibrarian;</pre>

<p>Return true if the patron is a superlibrarian.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_adult"
>is_adult</a></h3>

<p>my $is_adult = $patron-&#62;is_adult</p>

<p>Return true if the patron has a category with a type Adult (A) or Organization (I)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_child"
>is_child</a></h3>

<p>my $is_child = $patron-&#62;is_child</p>

<p>Return true if the patron has a category with a type Child (C)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="has_valid_userid"
>has_valid_userid</a></h3>

<p>my $patron = Koha::Patrons-&#62;find(42); $patron-&#62;userid( $new_userid ); my $has_a_valid_userid = $patron-&#62;has_valid_userid</p>

<p>my $patron = Koha::Patron-&#62;new( $params ); my $has_a_valid_userid = $patron-&#62;has_valid_userid</p>

<p>Return true if the current userid of this patron is valid/unique, otherwise false.</p>

<p>Note that this should be done in $self-&#62;store instead and raise an exception if needed.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="generate_userid"
>generate_userid</a></h3>

<pre>    $patron-&#62;generate_userid;

    If you do not have a plugin for generating a userid, we will call
    the internal method here that returns firstname.surname[.number],
    where number is an optional suffix to make the userid unique.
    (Its behavior has not been changed on bug 32426.)

    If you have plugin(s), the first valid response will be used.
    A plugin is assumed to return a valid userid as suggestion, but not
    assumed to save it already.
    Does not fallback to internal (you could arrange for that in your plugin).
    Clears userid when there are no valid plugin responses.</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="add_extended_attribute"
>add_extended_attribute</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="extended_attributes"
>extended_attributes</a></h3>

<p>Return object of Koha::Patron::Attributes type with all attributes set for this patron</p>

<p>Or setter FIXME</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="messages"
>messages</a></h3>

<pre>    my $messages = $patron-&#62;messages;</pre>

<p>Return the message attached to the patron.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="lock"
>lock</a></h3>

<pre>    Koha::Patrons-&#62;find($id)-&#62;lock({ expire =&#62; 1, remove =&#62; 1 });

    Lock and optionally expire a patron account.
    Remove holds and article requests if remove flag set.
    In order to distinguish from locking by entering a wrong password, let&#39;s
    call this an administrative lockout.</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="anonymize"
>anonymize</a></h3>

<pre>    Koha::Patrons-&#62;find($id)-&#62;anonymize;

    Anonymize or clear borrower fields. Fields in BorrowerMandatoryField
    are randomized, other personal data is cleared too.
    Patrons with issues are skipped.</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="add_guarantor"
>add_guarantor</a></h3>

<pre>    my $relationship = $patron-&#62;add_guarantor(
        {
            borrowernumber =&#62; $borrowernumber,
            relationships  =&#62; $relationship,
        }
    );

    Adds a new guarantor to a patron.</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_extended_attribute"
>get_extended_attribute</a></h3>

<p>my $attribute_value = $patron-&#62;get_extended_attribute( $code );</p>

<p>Return the attribute for the code passed in parameter.</p>

<p>It not exist it returns undef</p>

<p>Note that this will not work for repeatable attribute types.</p>

<p>Maybe you certainly not want to use this method, it is actually only used for SHOW_BARCODE (which should be a real patron&#39;s attribute (not extended)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="to_api"
>to_api</a></h3>

<pre>    my $json = $patron-&#62;to_api;</pre>

<p>Overloaded method that returns a JSON representation of the Koha::Patron object, suitable for API output.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="to_api_mapping"
>to_api_mapping</a></h3>

<p>This method returns the mapping for representing a Koha::Patron object on the API.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="queue_notice"
>queue_notice</a></h3>

<pre>    Koha::Patrons-&#62;queue_notice({ letter_params =&#62; $letter_params, message_name =&#62; &#39;DUE&#39;});
    Koha::Patrons-&#62;queue_notice({ letter_params =&#62; $letter_params, message_transports =&#62; \@message_transports });
    Koha::Patrons-&#62;queue_notice({ letter_params =&#62; $letter_params, message_transports =&#62; \@message_transports, test_mode =&#62; 1 });

    Queue messages to a patron. Can pass a message that is part of the message_attributes
    table or supply the transport to use.

    If passed a message name we retrieve the patrons preferences for transports
    Otherwise we use the supplied transport. In the case of email or sms we fall back to print if
    we have no address/number for sending

    $letter_params is a hashref of the values to be passed to GetPreparedLetter

    test_mode will only report which notices would be sent, but nothing will be queued</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="safe_to_delete"
>safe_to_delete</a></h3>

<pre>    my $result = $patron-&#62;safe_to_delete;
    if ( $result eq &#39;has_guarantees&#39; ) { ... }
    elsif ( $result ) { ... }
    else { # cannot delete }</pre>

<p>This method tells if the Koha:Patron object can be deleted. Possible return values</p>

<dl>
<dt><a name="&#39;ok&#39;"
>&#39;ok&#39;</a></dt>

<dd>
<dt><a name="&#39;has_checkouts&#39;"
>&#39;has_checkouts&#39;</a></dt>

<dd>
<dt><a name="&#39;has_debt&#39;"
>&#39;has_debt&#39;</a></dt>

<dd>
<dt><a name="&#39;has_guarantees&#39;"
>&#39;has_guarantees&#39;</a></dt>

<dd>
<dt><a name="&#39;is_anonymous_patron&#39;"
>&#39;is_anonymous_patron&#39;</a></dt>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="recalls"
>recalls</a></h3>

<pre>    my $recalls = $patron-&#62;recalls;</pre>

<p>Return the patron&#39;s recalls.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="account_balance"
>account_balance</a></h3>

<pre>    my $balance = $patron-&#62;account_balance</pre>

<p>Return the patron&#39;s account balance</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="notify_library_of_registration"
>notify_library_of_registration</a></h3>

<p>$patron-&#62;notify_library_of_registration( $email_patron_registrations );</p>

<p>Send patron registration email to library if EmailPatronRegistrations system preference is enabled.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="has_messaging_preference"
>has_messaging_preference</a></h3>

<p>my $bool = $patron-&#62;has_messaging_preference({ message_name =&#62; $message_name, # A value from message_attributes.message_name message_transport_type =&#62; $message_transport_type, # email, sms, phone, itiva, etc... wants_digest =&#62; $wants_digest, # 1 if you are looking for the digest version, don&#39;t pass if you just want either });</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="can_patron_change_staff_only_lists"
>can_patron_change_staff_only_lists</a></h3>

<p>$patron-&#62;can_patron_change_staff_only_lists;</p>

<p>Return 1 if a patron has &#39;Superlibrarian&#39; or &#39;Catalogue&#39; permission. Otherwise, return 0.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="can_patron_change_permitted_staff_lists"
>can_patron_change_permitted_staff_lists</a></h3>

<p>$patron-&#62;can_patron_change_permitted_staff_lists;</p>

<p>Return 1 if a patron has &#39;Superlibrarian&#39; or &#39;Catalogue&#39; and &#39;edit_public_list_contents&#39; permissions. Otherwise, return 0.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="encode_secret"
>encode_secret</a></h3>

<pre>  $patron-&#62;encode_secret($secret32);</pre>

<p>Secret (TwoFactorAuth expects it in base32 format) is encrypted. You still need to call -&#62;store.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="decoded_secret"
>decoded_secret</a></h3>

<pre>  my $secret32 = $patron-&#62;decoded_secret;</pre>

<p>Decode the patron secret. We expect to get back a base32 string, but this is not checked here. Caller of encode_secret is responsible for that.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="virtualshelves"
>virtualshelves</a></h3>

<pre>    my $shelves = $patron-&#62;virtualshelves;</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="get_savings"
>get_savings</a></h3>

<pre>    my $savings = $patron-&#62;get_savings;</pre>

<p>Use the replacement price of patron&#39;s old and current issues to calculate how much they have &#39;saved&#39; by using the library.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Internal_methods"
>Internal methods</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="_type"
>_type</a></h3>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Kyle M Hall &#60;kyle@bywatersolutions.com&#62; Alex Sassmannshausen &#60;alex.sassmannshausen@ptfs-europe.com&#62; Martin Renvoize &#60;martin.renvoize@ptfs-europe.com&#62;</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
