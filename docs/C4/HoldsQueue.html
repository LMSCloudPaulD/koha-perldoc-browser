<html><head><title>C4::HoldsQueue</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Wed Mar 15 18:19:35 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#TransportCostMatrix'>TransportCostMatrix</a>
    <li class='indexItem indexItem2'><a href='#UpdateTransportCostMatrix'>UpdateTransportCostMatrix</a>
    <li class='indexItem indexItem2'><a href='#GetHoldsQueueItems'>GetHoldsQueueItems</a>
    <li class='indexItem indexItem2'><a href='#CreateQueue'>CreateQueue</a>
    <li class='indexItem indexItem2'><a href='#GetBibsWithPendingHoldRequests'>GetBibsWithPendingHoldRequests</a>
    <li class='indexItem indexItem2'><a href='#GetPendingHoldRequestsForBib'>GetPendingHoldRequestsForBib</a>
    <li class='indexItem indexItem2'><a href='#GetItemsAvailableToFillHoldRequestsForBib'>GetItemsAvailableToFillHoldRequestsForBib</a>
    <li class='indexItem indexItem2'><a href='#_checkHoldPolicy'>_checkHoldPolicy</a>
    <li class='indexItem indexItem2'><a href='#MapItemsToHoldRequests'>MapItemsToHoldRequests</a>
    <li class='indexItem indexItem2'><a href='#CreatePickListFromItemMap'>CreatePickListFromItemMap</a>
    <li class='indexItem indexItem2'><a href='#AddToHoldTargetMap'>AddToHoldTargetMap</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#update_queue_for_biblio'>update_queue_for_biblio</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Return_value'>Return value</a>
        <li class='indexItem indexItem4'><a href='#Optional_parameters'>Optional parameters</a>
      </ul>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="TransportCostMatrix"
>TransportCostMatrix</a></h2>

<pre>  TransportCostMatrix();</pre>

<p>Returns Transport Cost Matrix as a hashref &#60;to branch code&#62; =&#62; &#60;from branch code&#62; =&#62; cost</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="UpdateTransportCostMatrix"
>UpdateTransportCostMatrix</a></h2>

<pre>  UpdateTransportCostMatrix($records);</pre>

<p>Updates full Transport Cost Matrix table. $records is an arrayref of records. Records: { frombranch =&#62; &#60;code&#62;, tobranch =&#62; &#60;code&#62;, cost =&#62; &#60;figure&#62;, disable_transfer =&#62; &#60;0,1&#62; }</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetHoldsQueueItems"
>GetHoldsQueueItems</a></h2>

<pre>  GetHoldsQueueItems({ branchlimit =&#62; $branch, itemtypeslimit =&#62;  $itype, ccodeslimit =&#62; $ccode, locationslimit =&#62; $location );</pre>

<p>Returns hold queue for a holding branch. If branch is omitted, then whole queue is returned</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CreateQueue"
>CreateQueue</a></h2>

<pre>  CreateQueue();</pre>

<p>Top level function that turns reserves into tmp_holdsqueue and hold_fill_targets.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetBibsWithPendingHoldRequests"
>GetBibsWithPendingHoldRequests</a></h2>

<pre>  my $biblionumber_aref = GetBibsWithPendingHoldRequests();</pre>

<p>Return an arrayref of the biblionumbers of all bibs that have one or more unfilled hold requests.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetPendingHoldRequestsForBib"
>GetPendingHoldRequestsForBib</a></h2>

<pre>  my $requests = GetPendingHoldRequestsForBib($biblionumber);</pre>

<p>Returns an arrayref of hashrefs to pending, unfilled hold requests on the bib identified by $biblionumber. The following keys are present in each hashref:</p>

<pre>    biblionumber
    borrowernumber
    itemnumber
    priority
    branchcode
    reservedate
    reservenotes
    borrowerbranch</pre>

<p>The arrayref is sorted in order of increasing priority.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetItemsAvailableToFillHoldRequestsForBib"
>GetItemsAvailableToFillHoldRequestsForBib</a></h2>

<pre>  my $available_items = GetItemsAvailableToFillHoldRequestsForBib($biblionumber, $branches_ar);</pre>

<p>Returns an arrayref of items available to fill hold requests for the bib identified by <code>$biblionumber</code>. An item is available to fill a hold request if and only if:</p>

<pre>    * it is not on loan
    * it is not withdrawn
    * it is not marked notforloan
    * it is not currently in transit
    * it is not lost
    * it is not sitting on the hold shelf
    * it is not damaged (unless AllowHoldsOnDamagedItems is on)</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_checkHoldPolicy"
>_checkHoldPolicy</a></h2>

<pre>    _checkHoldPolicy($item, $request)

    check if item agrees with hold policies</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="MapItemsToHoldRequests"
>MapItemsToHoldRequests</a></h2>

<pre>  MapItemsToHoldRequests($hold_requests, $available_items, $branches, $transport_cost_matrix)</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CreatePickListFromItemMap"
>CreatePickListFromItemMap</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="AddToHoldTargetMap"
>AddToHoldTargetMap</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="update_queue_for_biblio"
>update_queue_for_biblio</a></h3>

<pre>    my $result = update_queue_for_biblio(
        {
            biblio_id             =&#62; $biblio_id,
          [ branches_to_use       =&#62; $branches_to_use,
            transport_cost_matrix =&#62; $transport_cost_matrix,
            delete                =&#62; $delete, ]
        }
    );</pre>

<p>Given a <i>biblio_id</i>, this method calculates and sets the holds queue entries for the biblio&#39;s holds, and the hold fill targets (items).</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h4>

<p>It return a hashref containing:</p>

<dl>
<dt><a name="requests:_the_pending_holds_count_for_the_biblio."
><i>requests</i>: the pending holds count for the biblio.</a></dt>

<dd>
<dt><a name="available_items_the_count_of_items_that_are_available_to_fill_holds_for_the_biblio."
><i>available_items</i> the count of items that are available to fill holds for the biblio.</a></dt>

<dd>
<dt><a name="mapped_items_the_total_items_that_got_mapped."
><i>mapped_items</i> the total items that got mapped.</a></dt>
</dl>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Optional_parameters"
>Optional parameters</a></h4>

<dl>
<dt><a name="branches_to_use_a_list_of_branchcodes_to_be_used_to_restrict_which_items_can_be_used."
><i>branches_to_use</i> a list of branchcodes to be used to restrict which items can be used.</a></dt>

<dd>
<dt><a name="transport_cost_matrix_is_the_output_of_TransportCostMatrix."
><i>transport_cost_matrix</i> is the output of <code>TransportCostMatrix</code>.</a></dt>

<dd>
<dt><a name="delete_tells_the_method_to_delete_prior_entries_on_the_related_tables_for_the_biblio_id."
><i>delete</i> tells the method to delete prior entries on the related tables for the biblio_id.</a></dt>
</dl>

<p>Note: All the optional parameters will be calculated in the method if omitted. They are allowed to be passed to avoid calculating them many times inside loops.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
