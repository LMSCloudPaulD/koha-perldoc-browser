<html><head><title>Koha::EDI</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Fri Dec 30 12:26:26 2022 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#SUBROUTINES'>SUBROUTINES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#process_quote'>process_quote</a>
    <li class='indexItem indexItem2'><a href='#process_invoice'>process_invoice</a>
    <li class='indexItem indexItem2'><a href='#process_ordrsp'>process_ordrsp</a>
    <li class='indexItem indexItem2'><a href='#create_edi_order'>create_edi_order</a>
    <li class='indexItem indexItem2'><a href='#receipt_items'>receipt_items</a>
    <li class='indexItem indexItem2'><a href='#transfer_items'>transfer_items</a>
    <li class='indexItem indexItem2'><a href='#get_edifact_ean'>get_edifact_ean</a>
    <li class='indexItem indexItem2'><a href='#quote_item'>quote_item</a>
    <li class='indexItem indexItem2'><a href='#title_level_class'>title_level_class</a>
    <li class='indexItem indexItem2'><a href='#_create_bib_from_quote'>_create_bib_from_quote</a>
    <li class='indexItem indexItem2'><a href='#_create_item_from_quote'>_create_item_from_quote</a>
    <li class='indexItem indexItem2'><a href='#_get_invoiced_price'>_get_invoiced_price</a>
    <li class='indexItem indexItem2'><a href='#_discounted_price'>_discounted_price</a>
    <li class='indexItem indexItem2'><a href='#_check_for_existing_bib'>_check_for_existing_bib</a>
    <li class='indexItem indexItem2'><a href='#_get_budget'>_get_budget</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT'>COPYRIGHT</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Koha::EDI</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>   Module exporting subroutines used in EDI processing for Koha</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<pre>   Subroutines called by batch processing to handle Edifact
   messages of various types and related utilities</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<pre>   These routines should really be methods of some object.
   get_edifact_ean is a stopgap which should be replaced</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SUBROUTINES"
>SUBROUTINES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="process_quote"
>process_quote</a></h2>

<pre>    process_quote(quote_message);

   passed a message object for a quote, parses it creating an order basket
   and orderlines in the database
   updates the message&#39;s status to received in the database and adds the
   link to basket</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="process_invoice"
>process_invoice</a></h2>

<pre>    process_invoice(invoice_message)

    passed a message object for an invoice, add the contained invoices
    and update the orderlines referred to in the invoice
    As an Edifact invoice is in effect a despatch note this receipts the
    appropriate quantities in the orders

    no meaningful return value</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="process_ordrsp"
>process_ordrsp</a></h2>

<pre>     process_ordrsp(ordrsp_message)

     passed a message object for a supplier response, process the contents
     If an orderline is cancelled cancel the corresponding orderline in koha
     otherwise record the supplier message against it

     no meaningful return value</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="create_edi_order"
>create_edi_order</a></h2>

<pre>    create_edi_order( { parameter_hashref } )

    parameters must include basketno and ean

    branchcode can optionally be passed

    returns 1 on success undef otherwise

    if the parameter noingest is set the formatted order is returned
    and not saved in the database. This functionality is intended for debugging only</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="receipt_items"
>receipt_items</a></h2>

<pre>    receipt_items( schema_obj, invoice_line, ordernumber, $quantity)

    receipts the items recorded on this invoice line

    no meaningful return</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="transfer_items"
>transfer_items</a></h2>

<pre>    transfer_items(schema, invoice_line, originating_order, receiving_order, $quantity)

    Transfer the items covered by this invoice line from their original
    order to another order recording the partial fulfillment of the original
    order

    no meaningful return</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_edifact_ean"
>get_edifact_ean</a></h2>

<pre>    $ean = get_edifact_ean();

    routine to return the ean.</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="quote_item"
>quote_item</a></h2>

<pre>     quote_item(lineitem, quote_message);

      Called by process_quote to handle an individual lineitem
     Generate the biblios and items if required and orderline linking to them

     Returns 1 on success undef on error

     Most usual cause of error is a line with no or incorrect budget codes
     which woild cause order creation to abort
     If other correct lines exist these are processed and the erroneous line os logged</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="title_level_class"
>title_level_class</a></h2>

<pre>      classmark = title_level_class(edi_item)

      Trys to return a title level classmark from a quote message line
      Will return a dewey or lcc classmark if one exists according to the
      value in DefaultClassificationSource syspref

      If unable to returns the shelfmark or classification from the GIR segment

      If all else fails returns empty string</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_create_bib_from_quote"
>_create_bib_from_quote</a></h2>

<pre>       marc_record_obj = _create_bib_from_quote(lineitem, quote)

       Returns a MARC::Record object based on the  info in the quote&#39;s lineitem</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_create_item_from_quote"
>_create_item_from_quote</a></h2>

<pre>       item_hashref = _create_item_from_quote( lineitem, quote)

       returns a hashref representing the item fields specified in the quote</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_get_invoiced_price"
>_get_invoiced_price</a></h2>

<pre>      (price, price_tax_excluded) = _get_invoiced_price(line_object, $quantity)

      Returns an array of unitprice and unitprice_tax_excluded derived from the lineitem
      monetary fields</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_discounted_price"
>_discounted_price</a></h2>

<pre>      ecost = _discounted_price(discount, item_price, discounted_price)

      utility subroutine to return a price calculated from the
      vendors discount and quoted price
      if invoice has a field containing discounted price that is returned
      instead of recalculating</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_check_for_existing_bib"
>_check_for_existing_bib</a></h2>

<pre>     (biblionumber, biblioitemnumber) = _check_for_existing_bib(isbn_or_ean)

     passed an isbn or ean attempts to locate a match bib
     On success returns biblionumber and biblioitemnumber
     On failure returns undefined/an empty list</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_get_budget"
>_get_budget</a></h2>

<pre>     b = _get_budget(schema_obj, budget_code)

     Returns the Aqbudget object for the active budget given the passed budget_code
     or undefined if one does not exist</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<pre>   Colin Campbell &#60;colin.campbell@ptfs-europe.com&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<pre>   Copyright 2014,2015 PTFS-Europe Ltd
   This program is free software, You may redistribute it under
   under the terms of the GNU General Public License</pre>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
