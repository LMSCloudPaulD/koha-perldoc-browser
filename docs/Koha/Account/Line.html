<html><head><title>Koha::Account::Line</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Mon Jul  1 00:18:50 2024 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#API'>API</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Class_methods'>Class methods</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#patron'>patron</a>
      <li class='indexItem indexItem3'><a href='#manager'>manager</a>
      <li class='indexItem indexItem3'><a href='#item'>item</a>
      <li class='indexItem indexItem3'><a href='#checkout'>checkout</a>
      <li class='indexItem indexItem3'><a href='#library'>library</a>
      <li class='indexItem indexItem3'><a href='#credit_type'>credit_type</a>
      <li class='indexItem indexItem3'><a href='#debit_type'>debit_type</a>
      <li class='indexItem indexItem3'><a href='#credit_offsets'>credit_offsets</a>
      <li class='indexItem indexItem3'><a href='#debit_offsets'>debit_offsets</a>
      <li class='indexItem indexItem3'><a href='#credits'>credits</a>
      <li class='indexItem indexItem3'><a href='#debits'>debits</a>
      <li class='indexItem indexItem3'><a href='#void'>void</a>
      <li class='indexItem indexItem3'><a href='#cancel'>cancel</a>
      <li class='indexItem indexItem3'><a href='#reduce'>reduce</a>
      <li class='indexItem indexItem3'><a href='#apply'>apply</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#arguments_hashref'>arguments hashref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#payout'>payout</a>
      <li class='indexItem indexItem3'><a href='#adjust'>adjust</a>
      <li class='indexItem indexItem3'><a href='#is_credit'>is_credit</a>
      <li class='indexItem indexItem3'><a href='#is_debit'>is_debit</a>
      <li class='indexItem indexItem3'><a href='#to_api_mapping'>to_api_mapping</a>
      <li class='indexItem indexItem3'><a href='#is_renewable'>is_renewable</a>
      <li class='indexItem indexItem3'><a href='#renew_item'>renew_item</a>
      <li class='indexItem indexItem3'><a href='#store'>store</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Internal_methods'>Internal methods</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#_type'>_type</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Name_mappings'>Name mappings</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#%24allowed_update'>$allowed_update</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Koha::Account::Line - Koha accountline Object class</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="API"
>API</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Class_methods"
>Class methods</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="patron"
>patron</a></h3>

<p>Return the patron linked to this account line</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="manager"
>manager</a></h3>

<p>Return the manager linked to this account line</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="item"
>item</a></h3>

<p>Return the item linked to this account line if exists</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="checkout"
>checkout</a></h3>

<p>Return the checkout linked to this account line if exists</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="library"
>library</a></h3>

<p>Returns a Koha::Library object representing where the accountline was recorded</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="credit_type"
>credit_type</a></h3>

<p>Return the credit_type linked to this account line</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="debit_type"
>debit_type</a></h3>

<p>Return the debit_type linked to this account line</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="credit_offsets"
>credit_offsets</a></h3>

<p>Return the credit_offsets linked to this account line if some exist</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="debit_offsets"
>debit_offsets</a></h3>

<p>Return the debit_offsets linked to this account line if some exist</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="credits"
>credits</a></h3>

<pre>  my $credits = $accountline-&#62;credits;
  my $credits = $accountline-&#62;credits( $cond, $attr );</pre>

<p>Return the credits linked to this account line if some exist. Search conditions and attributes may be passed if you wish to filter the resultant resultant resultset.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="debits"
>debits</a></h3>

<pre>  my $debits = $accountline-&#62;debits;
  my $debits = $accountline-&#62;debits( $cond, $attr );</pre>

<p>Return the debits linked to this account line if some exist. Search conditions and attributes may be passed if you wish to filter the resultant resultant resultset.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="void"
>void</a></h3>

<pre>  $payment_accountline-&#62;void({
      interface =&#62; $interface,
      [ staff_id =&#62; $staff_id, branch =&#62; $branchcode ]
  });</pre>

<p>Used to &#39;void&#39; (or reverse) a payment/credit. It will roll back any offsets created by the application of this credit upon any debits and mark the credit as &#39;void&#39; by updating it&#39;s status to &#34;VOID&#34;.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="cancel"
>cancel</a></h3>

<pre>  $debit_accountline-&#62;cancel();</pre>

<p>Cancel a charge. It will mark the debit as &#39;cancelled&#39; by updating its status to &#39;CANCELLED&#39;.</p>

<p>Charges that have been fully or partially paid cannot be cancelled.</p>

<p>Returns the cancellation accountline.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="reduce"
>reduce</a></h3>

<pre>  $charge_accountline-&#62;reduce({
      reduction_type =&#62; $reduction_type
  });</pre>

<p>Used to &#39;reduce&#39; a charge/debit by adding a credit to offset against the amount outstanding.</p>

<p>May be used to apply a discount whilst retaining the original debit amounts or to apply a full or partial refund for example when a lost item is found and returned.</p>

<p>It will immediately be applied to the given debit unless the debit has already been paid, in which case a &#39;zero&#39; offset will be added to maintain a link to the debit but the outstanding credit will be left so it may be applied to other debts.</p>

<p>Reduction type may be one of:</p>

<p>* REFUND * DISCOUNT</p>

<p>Returns the reduction accountline (which will be a credit)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="apply"
>apply</a></h3>

<pre>    my $debits = $account-&#62;outstanding_debits;
    my $credit = $credit-&#62;apply( { debits =&#62; $debits } );</pre>

<p>Applies the credit to a given debits array reference.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="arguments_hashref"
>arguments hashref</a></h4>

<dl>
<dt><a name="debits_-_Koha::Account::Lines_object_set_of_debits"
>debits - Koha::Account::Lines object set of debits</a></dt>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="payout"
>payout</a></h3>

<pre>  $credit_accountline-&#62;payout(
    {
        payout_type =&#62; $payout_type,
        register_id =&#62; $register_id,
        staff_id    =&#62; $staff_id,
        interface   =&#62; &#39;intranet&#39;,
        amount      =&#62; $amount
    }
  );</pre>

<p>Used to &#39;pay out&#39; a credit to a user.</p>

<p>Payout type may be one of any existing payment types</p>

<p>Returns the payout debit line that is created via this transaction.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="adjust"
>adjust</a></h3>

<p>This method allows updating a debit or credit on a patron&#39;s account</p>

<pre>    $account_line-&#62;adjust(
        {
            amount    =&#62; $amount,
            type      =&#62; $update_type,
            interface =&#62; $interface
        }
    );</pre>

<p>$update_type can be any of: - overdue_update</p>

<p>Authors Note: The intention here is that this method is only used to adjust accountlines where the final amount is not yet known/fixed. Incrementing fines are the only existing case at the time of writing, all other forms of &#39;adjustment&#39; should be recorded as distinct credits or debits and applied, via an offset, to the corresponding debit or credit.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_credit"
>is_credit</a></h3>

<pre>    my $bool = $line-&#62;is_credit;</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_debit"
>is_debit</a></h3>

<pre>    my $bool = $line-&#62;is_debit;</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="to_api_mapping"
>to_api_mapping</a></h3>

<p>This method returns the mapping for representing a Koha::Account::Line object on the API.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="is_renewable"
>is_renewable</a></h3>

<pre>    my $bool = $line-&#62;is_renewable;</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="renew_item"
>renew_item</a></h3>

<pre>    my $renew_result = $line-&#62;renew_item;</pre>

<p>Conditionally attempt to renew an item and return the outcome. This is as a consequence of the fine on an item being fully paid off. Caller must call is_renewable before.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="store"
>store</a></h3>

<p>Specific store method to generate credit number before saving</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Internal_methods"
>Internal methods</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="_type"
>_type</a></h3>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Name_mappings"
>Name mappings</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="$allowed_update"
>$allowed_update</a></h3>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Kyle M Hall &#60;kyle@bywatersolutions.com &#62; Tom&#225;s Cohen Arazi &#60;tomascohen@theke.io&#62; Martin Renvoize &#60;martin.renvoize@ptfs-europe.com&#62;</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
