<html><head><title>C4::Reports::Guided</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Thu Nov 28 06:07:21 2024 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#get_report_areas'>get_report_areas</a>
    <li class='indexItem indexItem2'><a href='#get_report_types'>get_report_types</a>
    <li class='indexItem indexItem2'><a href='#get_report_groups'>get_report_groups</a>
    <li class='indexItem indexItem2'><a href='#get_all_tables'>get_all_tables</a>
    <li class='indexItem indexItem2'><a href='#get_columns(%24area)'>get_columns($area)</a>
    <li class='indexItem indexItem2'><a href='#build_query(%24columns%2C%24criteria%2C%24orderby%2C%24area)'>build_query($columns,$criteria,$orderby,$area)</a>
    <li class='indexItem indexItem2'><a href='#get_criteria(%24area%2C%24cgi)%3B'>get_criteria($area,$cgi);</a>
    <li class='indexItem indexItem2'><a href='#select_2_select_count'>select_2_select_count</a>
    <li class='indexItem indexItem2'><a href='#execute_query'>execute_query</a>
    <li class='indexItem indexItem2'><a href='#save_report(%24sql%2C%24name%2C%24type%2C%24notes)'>save_report($sql,$name,$type,$notes)</a>
    <li class='indexItem indexItem2'><a href='#get_column_type(%24column)'>get_column_type($column)</a>
    <li class='indexItem indexItem2'><a href='#get_distinct_values(%24column)'>get_distinct_values($column)</a>
    <li class='indexItem indexItem2'><a href='#get_sql(%24report_id)'>get_sql($report_id)</a>
    <li class='indexItem indexItem2'><a href='#GetReservedAuthorisedValues'>GetReservedAuthorisedValues</a>
    <li class='indexItem indexItem2'><a href='#IsAuthorisedValueValid'>IsAuthorisedValueValid</a>
    <li class='indexItem indexItem2'><a href='#GetParametersFromSQL'>GetParametersFromSQL</a>
    <li class='indexItem indexItem2'><a href='#ValidateSQLParameters'>ValidateSQLParameters</a>
    <li class='indexItem indexItem2'><a href='#EmailReport'>EmailReport</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#convert_sql'>convert_sql</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>C4::Reports::Guided - Module for generating guided reports</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use C4::Reports::Guided;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_report_areas"
>get_report_areas</a></h2>

<p>This will return a list of all the available report areas</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_report_types"
>get_report_types</a></h2>

<p>This will return a list of all the available report types</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_report_groups"
>get_report_groups</a></h2>

<p>This will return a list of all the available report areas with groups</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_all_tables"
>get_all_tables</a></h2>

<p>This will return a list of all tables in the database</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_columns($area)"
>get_columns($area)</a></h2>

<p>This will return a list of all columns for a report area</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="build_query($columns,$criteria,$orderby,$area)"
>build_query($columns,$criteria,$orderby,$area)</a></h2>

<p>This will build the sql needed to return the results asked for, $columns is expected to be of the format tablename.columnname. This is what get_columns returns.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_criteria($area,$cgi);"
>get_criteria($area,$cgi);</a></h2>

<p>Returns an arraref to hashrefs suitable for using in a tmpl_loop. With the criteria and available values.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="select_2_select_count"
>select_2_select_count</a></h2>

<pre> returns $sql, $offset, $limit
 $sql returned will be transformed to:
  ~ remove any LIMIT clause
  ~ replace SELECT clause w/ SELECT count(*)</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'

>strip_limit This removes the LIMIT from the query so that a custom one can be specified. Usage: ($new_sql, $offset, $limit) = strip_limit($sql);</a></h2>

<p>Where: $sql is the query to modify $new_sql is the resulting query $offset is the offset value, if the LIMIT was the two-argument form, 0 if it wasn&#39;t otherwise given. $limit is the limit value</p>

<p>Notes: * This makes an effort to not break subqueries that have their own LIMIT specified. It does that by only removing a LIMIT if it comes after a WHERE clause (which isn&#39;t perfect, but at least should make more cases work - subqueries with a limit in the WHERE will still break.) * If your query doesn&#39;t have a WHERE clause then all LIMITs will be removed. This may break some subqueries, but is hopefully rare enough to not be a big issue.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="execute_query"
>execute_query</a></h2>

<pre>  ($sth, $error) = execute_query({
      sql =&#62; $sql,
      offset =&#62; $offset,
      limit =&#62; $limit
      sql_params =&#62; \@sql_params],
      report_id =&#62; $report_id
  })</pre>

<p>This function returns a DBI statement handler from which the caller can fetch the results of the SQL passed via <code>$sql</code>.</p>

<p>If passed any query other than a SELECT, or if there is a DB error, <code>$errors</code> is returned, and is a hashref containing the error after this manner:</p>

<p><code>$error-</code>{&#39;sqlerr&#39;}&#62; contains the offending SQL keyword. <code>$error-</code>{&#39;queryerr&#39;}&#62; contains the native db engine error returned for the query.</p>

<p><code>$offset</code>, and <code>$limit</code> are required parameters.</p>

<p><code>\@sql_params</code> is an optional list of parameter values to paste in. The caller is responsible for making sure that <code>$sql</code> has placeholders and that the number placeholders matches the number of parameters.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="save_report($sql,$name,$type,$notes)"
>save_report($sql,$name,$type,$notes)</a></h2>

<p>Given some sql and a name this will saved it so that it can reused Returns id of the newly created report</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_column_type($column)"
>get_column_type($column)</a></h2>

<p>This takes a column name of the format table.column and will return what type it is (free text, set values, date)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_distinct_values($column)"
>get_distinct_values($column)</a></h2>

<p>Given a column name, return an arrary ref of hashrefs suitable for use as a tmpl_loop with the distinct values of the column</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_sql($report_id)"
>get_sql($report_id)</a></h2>

<p>Given a report id, return the SQL statement for that report. Otherwise, it just returns.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetReservedAuthorisedValues"
>GetReservedAuthorisedValues</a></h2>

<pre>    my %reserved_authorised_values = GetReservedAuthorisedValues();</pre>

<p>Returns a hash containig all reserved words</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="IsAuthorisedValueValid"
>IsAuthorisedValueValid</a></h2>

<pre>    my $is_valid_ath_value = IsAuthorisedValueValid($authorised_value)</pre>

<p>Returns 1 if $authorised_value is on the reserved authorised values list or in the authorised value categories defined in</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetParametersFromSQL"
>GetParametersFromSQL</a></h2>

<pre>    my @sql_parameters = GetParametersFromSQL($sql)</pre>

<p>Returns an arrayref of hashes containing the keys name and authval</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ValidateSQLParameters"
>ValidateSQLParameters</a></h2>

<pre>    my @problematic_parameters = ValidateSQLParameters($sql)</pre>

<p>Returns an arrayref of hashes containing the keys name and authval of those SQL parameters that do not correspond to valid authorised names</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="EmailReport"
>EmailReport</a></h2>

<pre>    my ( $emails, $arrayrefs ) = EmailReport($report_id, $letter_code, $module, $branch, $email)</pre>

<p>Take a report and use it to process a Template Toolkit formatted notice Returns arrayrefs containing prepared letters and errors respectively</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="convert_sql"
>convert_sql</a></h3>

<p>my $updated_sql = C4::Reports::Guided::convert_sql( $sql );</p>

<p>Convert a sql query using biblioitems.marcxml to use the new biblio_metadata.metadata field instead</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Chris Cormack &#60;crc@liblime.com&#62;</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
