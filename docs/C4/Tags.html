<html><head><title>C4::Tags.pm</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÉ</text></svg>" />

<link rel="stylesheet" href="../sub.css">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Sat Oct 12 00:19:26 2024 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#C4%3A%3ATags.pm_-_Support_for_user_tagging_of_biblios.'>C4::Tags.pm - Support for user tagging of biblios.</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#get_count_by_tag_status'>get_count_by_tag_status</a>
    <li class='indexItem indexItem2'><a href='#add_tag(biblionumber%2Cterm%5B%2Cborrowernumber%5D)'>add_tag(biblionumber,term[,borrowernumber])</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#TO_DO%3A_Add_real_perldoc'>TO DO: Add real perldoc</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#External_Dictionary_(Ispell)_%5BRecommended%5D'>External Dictionary (Ispell) [Recommended]</a>
    <li class='indexItem indexItem2'><a href='#Table_Structure'>Table Structure</a>
    <li class='indexItem indexItem2'><a href='#Tricks'>Tricks</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="C4::Tags.pm_-_Support_for_user_tagging_of_biblios."
>C4::Tags.pm - Support for user tagging of biblios.</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_count_by_tag_status"
>get_count_by_tag_status</a></h2>

<pre>  get_count_by_tag_status($status);</pre>

<p>Takes a status and gets a count of tags with that status</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_tag(biblionumber,term[,borrowernumber])"
>add_tag(biblionumber,term[,borrowernumber])</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="TO_DO:_Add_real_perldoc"
>TO DO: Add real perldoc</a></h3>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="External_Dictionary_(Ispell)_[Recommended]"
>External Dictionary (Ispell) [Recommended]</a></h2>

<p>An external dictionary can be used as a means of &#34;pre-populating&#34; and tracking allowed terms based on the widely available Ispell dictionary. This can be the system dictionary or a personal version, but in order to support whitelisting, it must be editable to the process running Koha.</p>

<p>To enable, enter the absolute path to the ispell dictionary in the system preference &#34;TagsExternalDictionary&#34;.</p>

<p>Using external Ispell is recommended for both ease of use and performance. Note that any language version of Ispell can be installed. It is also possible to modify the dictionary at the command line to affect the desired content.</p>

<p>WARNING: The default Ispell dictionary includes (properly spelled) obscenities! Users should build their own wordlist and recompile Ispell based on it. See man ispell for instructions.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Table_Structure"
>Table Structure</a></h2>

<p>The tables used by tags are: tags_all tags_index tags_approval tags_blacklist</p>

<p>Your first thought may be that this looks a little complicated. It is, but only because it has to be. I&#39;ll try to explain.</p>

<p>tags_all - This table would be all we really need if we didn&#39;t care about moderation or performance or tags disappearing when borrowers are removed. Too bad, we do. Otherwise though, it contains all the relevant info about a given tag: tag_id - unique id number for it borrowernumber - user that entered it biblionumber - book record it is attached to term - tag &#34;term&#34; itself language - perhaps used later to influence weighting date_created - date and time it was created</p>

<p>tags_approval - Since we need to provide moderation, this table is used to track it. If no external dictionary is used, this table is the sole reference for approval and rejection. With an external dictionary, it tracks pending terms and past whitelist/blacklist actions. This could be called an &#34;approved terms&#34; table. See above regarding the External Dictionary. term - tag &#34;term&#34; itself approved - Negative, 0 or positive if tag is rejected, pending or approved. date_approved - date of last action approved_by - staffer performing the last action weight_total - total occurrence of term in any biblio by any users</p>

<p>tags_index - This table is for performance, because by far the most common operation will be fetching tags for a list of search results. We will have a set of biblios, and we will want ONLY their approved tags and overall weighting. While we could implement a query that would traverse tags_all filtered against tags_approval, the performance implications of trying to calculate that and the &#34;weight&#34; (number of times a tag appears) on the fly are drastic. term - approved term as it appears in tags_approval biblionumber - book record it is attached to weight - number of times tag applied by any user</p>

<p>tags_blacklist - A set of regular expression filters. Unsurprisingly, these should be perl- compatible (PCRE) for your version of perl. Since this is a blacklist, a term will be blocked if it matches any of the given patterns. WARNING: do not add blacklist regexps if you do not understand their operation and interaction. It is quite easy to define too simple or too complex a regexp and effectively block all terms. The blacklist operation is fairly resource intensive, since every line of tags_blacklist will need to be read and compared. It is recommended that tags_blacklist be used minimally, and only by an administrator with an understanding of regular expression syntax and performance.</p>

<p>So the best way to think about the different tables is that they are each tailored to a certain use. Note that tags_approval and tags_index do not rely on the user&#39;s borrower mapping, so the tag population can continue to grow even if a user (along with their corresponding rows in tags_all) is removed.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Tricks"
>Tricks</a></h2>

<p>If you want to auto-populate some tags for debugging, do something like this:</p>

<p>mysql&#62; select biblionumber from biblio where title LIKE &#34;%Health%&#34;; +--------------+ | biblionumber | +--------------+ | 18 | | 22 | | 24 | | 30 | | 44 | | 45 | | 46 | | 49 | | 111 | | 113 | | 128 | | 146 | | 155 | | 518 | | 522 | | 524 | | 530 | | 544 | | 545 | | 546 | | 549 | | 611 | | 613 | | 628 | | 646 | | 655 | +--------------+ 26 rows in set (0.00 sec)</p>

<p>Then, take those numbers and type/pipe them into this perl command line: perl -ne &#39;use C4::Tags qw(get_tags add_tag); use Data::Dumper;chomp; add_tag($_,&#34;health&#34;,51,1); print Dumper get_tags({limit=&#62;5,term=&#62;&#34;health&#34;,});&#39;</p>

<p>Note, the borrowernumber in this example is 51. Use your own or any arbitrary valid borrowernumber.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
